
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A declarative data engineering framework - Explicit over implicit, Stories over magic.">
      
      
      
        <link rel="canonical" href="https://henryodibi11.github.io/Odibi/ODIBI_DEEP_CONTEXT/">
      
      
        <link rel="prev" href="../features/cli/">
      
      
        <link rel="next" href="../reference/api/pipeline/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>AI Deep Context - Odibi Framework</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#odibi-deep-context" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Odibi Framework" class="md-header__button md-logo" aria-label="Odibi Framework" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Odibi Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AI Deep Context
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/henryodibi11/Odibi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    henryodibi11/Odibi
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
  Start Here

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../philosophy/" class="md-tabs__link">
          
  
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../guides/the_definitive_guide/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../validation/" class="md-tabs__link">
          
  
  
  Operate

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../reference/cheatsheet/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Odibi Framework" class="md-nav__button md-logo" aria-label="Odibi Framework" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Odibi Framework
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/henryodibi11/Odibi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    henryodibi11/Odibi
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Start Here
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Start Here
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../golden_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Golden Path
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../playbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Playbook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Learn
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Learn
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../philosophy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Philosophy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explanation/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/medallion_architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Medallion Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipelines & Nodes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/connections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/engines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/transformers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transformers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loading Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/stories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stories
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/orchestration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Orchestration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/bulk_copy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bulk Copy (SQL Server)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data Engineering 101
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data Engineering 101
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning/curriculum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Curriculum
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning/data_engineering_101/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Engineering 101
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learning/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dimensional Modeling (Tutorial)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dimensional Modeling (Tutorial)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/01_introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/02_dimension_pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dimension Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/03_date_dimension_pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Date Dimension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/04_fact_pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fact Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/05_aggregation_pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aggregation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/06_full_star_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Full Star Schema
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/07_semantic_layer_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Semantic Layer Intro
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/08_defining_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Defining Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/09_defining_dimensions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Defining Dimensions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/10_querying_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Querying Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/11_materializing_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Materializing Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/12_semantic_full_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Full Semantic Example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/dimensional_modeling/13_fk_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FK Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/the_definitive_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Definitive Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/decision_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decision Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/bronze_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bronze Layer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/silver_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Silver Layer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/gold_layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gold Layer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/spark_engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spark Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/azure_connections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Azure Connections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples (Copy/Paste)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples (Copy/Paste)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/canonical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/canonical/01_hello_world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Hello World
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/canonical/02_incremental_sql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Incremental SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/canonical/03_scd2_dimension/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. SCD2 Dimension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/canonical/04_fact_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Fact Table
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/canonical/05_full_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Full Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Patterns (Problem → Solution)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Patterns (Problem → Solution)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5_2" >
        
          
          <label class="md-nav__link" for="__nav_3_5_2" id="__nav_3_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data Loading
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data Loading
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/append_only_raw/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Append-Only Raw
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/incremental_stateful/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Incremental Stateful
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/merge_upsert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Merge/Upsert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/sql_server_merge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL Server Merge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/windowed_reprocess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windowed Reprocess
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/smart_read/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Smart Read
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/skip_if_unchanged/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Skip If Unchanged
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5_3" >
        
          
          <label class="md-nav__link" for="__nav_3_5_3" id="__nav_3_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Dimensional Modeling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dimensional Modeling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/dimension/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dimension Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/date_dimension/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Date Dimension
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/fact/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fact Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aggregation Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/scd2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SCD2 Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5_4" >
        
          
          <label class="md-nav__link" for="__nav_3_5_4" id="__nav_3_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Manufacturing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Manufacturing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/manufacturing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5_5" id="__nav_3_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Engineering
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Engineering
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/unit_conversion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Unit Conversion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/thermodynamics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thermodynamics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/anti_patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Anti-Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Common Tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Common Tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/writing_transformations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Writing Transformations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/custom_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Functions Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/variable_substitution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Variable Substitution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/explanation_feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Explanation Feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/api_data_sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Data Sources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/recipes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cookbook (Recipes)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Pipelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/best_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Best Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Interfaces
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Interfaces
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/cli_master_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Master Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/python_api_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python API Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Semantic Layer
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Semantic Layer
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../semantics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../semantics/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Defining Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../semantics/query/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Querying
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../semantics/materialize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Materializing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../semantics/runner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operate
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operate
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data Quality
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data Quality
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/contracts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contracts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validation Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/quality_gates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quality Gates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/quarantine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quarantine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/fk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FK Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Observability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/alerting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alerting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/diagnostics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Diagnostics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/lineage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lineage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/schema_tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Schema Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/catalog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Catalog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/catalog_sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Catalog Sync
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/production_deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/secrets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Secrets Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/setup_azure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Azure Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/performance_tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/wsl_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WSL Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cheatsheet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/yaml_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YAML Schema
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Templates Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/supported_formats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supported Formats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/PARITY_TABLE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engine Parity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    AI Deep Context
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Deep Context
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-critical-runtime-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Critical Runtime Behavior
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Critical Runtime Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-spark-temp-view-registration-most-important" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Spark Temp View Registration (MOST IMPORTANT)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-pandas-context-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Pandas Context Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-polars-context-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3 Polars Context Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-data-flow-between-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4 Data Flow Between Nodes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-core-execution-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Core Execution Model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Core Execution Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-pipeline-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Pipeline Execution Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-node-execution-phases" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Node Execution Phases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-error-handling-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Error Handling Strategies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-retry-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 Retry Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-context-factory" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 Context Factory
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-patterns-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Patterns Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Patterns Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-dimension-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Dimension Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-fact-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Fact Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-scd2-pattern-transformer" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 SCD2 Pattern (Transformer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-merge-pattern-transformer" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 Merge Pattern (Transformer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-aggregation-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5 Aggregation Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-date-dimension-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.6 Date Dimension Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-transformers-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Transformers Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Transformers Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-sql-core-transformers" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 SQL Core Transformers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-date-transformers" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Date Transformers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-relational-transformers" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 Relational Transformers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-advanced-transformers" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.4 Advanced Transformers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-delete-detection-transformer" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.5 Delete Detection Transformer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-validation-quarantine" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Validation &amp; Quarantine
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Validation &amp; Quarantine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-validation-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Validation Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-quarantine-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Quarantine Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-quality-gates" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Quality Gates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-connections-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Connections Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Connections Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-local-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Local Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-azure-adls-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Azure ADLS Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-azure-sql-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 Azure SQL Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-http-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4 HTTP Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-local-dbfs-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5 Local DBFS Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66-variable-substitution" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6 Variable Substitution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.6 Variable Substitution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-variables-var" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Variables: ${VAR}
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-variables-varsname" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Variables: ${vars.name}
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#date-variables-dateexpression" class="md-nav__link">
    <span class="md-ellipsis">
      
        Date Variables: ${date:expression}
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#67-api-fetching-rest-apis" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.7 API Fetching (REST APIs)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.7 API Fetching (REST APIs)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-get-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic GET API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-api-complex-queries" class="md-nav__link">
    <span class="md-ellipsis">
      
        POST API (Complex Queries)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-write-configuration-delta-lake-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Write Configuration (Delta Lake Features)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Write Configuration (Delta Lake Features)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-partitioning-z-ordering" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Partitioning &amp; Z-Ordering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-schema-evolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Schema Evolution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-auto-optimize-vacuum-optimize" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 Auto-Optimize (VACUUM &amp; OPTIMIZE)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-bronze-metadata-columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4 Bronze Metadata Columns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-skip-if-unchanged" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5 Skip If Unchanged
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-time-travel-read" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.6 Time Travel (Read)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77-streaming-writes-spark-structured-streaming" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.7 Streaming Writes (Spark Structured Streaming)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-alerts-notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Alerts &amp; Notifications
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Alerts &amp; Notifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-alert-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Alert Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-available-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Available Events
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-alert-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.3 Alert Types
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-system-catalog-the-brain" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. System Catalog (The Brain)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. System Catalog (The Brain)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-meta-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Meta Tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-cost-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3 Cost Tracking
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-openlineage-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. OpenLineage Integration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-foreign-key-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Foreign Key Validation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-orchestration-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. Orchestration Export
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Orchestration Export">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-airflow-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        12.1 Airflow Export
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-dagster-export" class="md-nav__link">
    <span class="md-ellipsis">
      
        12.2 Dagster Export
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-manufacturing-transformers" class="md-nav__link">
    <span class="md-ellipsis">
      
        13. Manufacturing Transformers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. Manufacturing Transformers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-detect-sequential-phases" class="md-nav__link">
    <span class="md-ellipsis">
      
        13.1 Detect Sequential Phases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-semantic-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        14. Semantic Layer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14. Semantic Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-metric-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.1 Metric Definitions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-dimension-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.2 Dimension Definitions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-semantic-queries" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.3 Semantic Queries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-materialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.4 Materialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-sql-server-views" class="md-nav__link">
    <span class="md-ellipsis">
      
        14.5 SQL Server Views
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-story-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        15. Story Generation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15. Story Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1 Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152-story-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2 Story Contents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153-viewing-stories" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.3 Viewing Stories
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#154-story-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.4 Story Metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#155-documentation-generation" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.5 Documentation Generation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-common-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        16. Common Workflows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16. Common Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161-run-a-pipeline-and-query-intermediate-results-spark" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.1 Run a Pipeline and Query Intermediate Results (Spark)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#162-debug-a-failing-node" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.2 Debug a Failing Node
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#163-add-a-new-scd2-dimension" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.3 Add a New SCD2 Dimension
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#164-create-a-custom-transformer" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.4 Create a Custom Transformer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#165-run-in-databricks" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.5 Run in Databricks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#166-incremental-ingestion-with-high-water-mark" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.6 Incremental Ingestion with High Water Mark
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#17-cli-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        17. CLI Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="17. CLI Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#171-core-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.1 Core Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#172-story-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.2 Story Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#173-validation-debug" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.3 Validation &amp; Debug
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#174-introspection-commands-ai-friendly" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.4 Introspection Commands (AI-Friendly)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#175-semantic-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        17.5 Semantic Layer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#18-anti-patterns-and-gotchas" class="md-nav__link">
    <span class="md-ellipsis">
      
        18. Anti-Patterns and Gotchas
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="18. Anti-Patterns and Gotchas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#181-node-naming" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.1 Node Naming
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#182-scd2-is-self-contained-no-write-block-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.2 SCD2 Is Self-Contained (No Write Block Needed)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#183-missing-depends_on-for-joins" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.3 Missing depends_on for Joins
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#184-engine-specific-sql-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.4 Engine-Specific SQL Syntax
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#185-performance-gotchas" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.5 Performance Gotchas
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#186-common-error-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        18.6 Common Error Messages
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#19-sql-server-writer" class="md-nav__link">
    <span class="md-ellipsis">
      
        19. SQL Server Writer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="19. SQL Server Writer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#191-merge-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        19.1 Merge Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#192-overwrite-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        19.2 Overwrite Strategies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-incremental-loading-advanced" class="md-nav__link">
    <span class="md-ellipsis">
      
        20. Incremental Loading (Advanced)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="20. Incremental Loading (Advanced)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#201-stateful-high-water-mark" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.1 Stateful High Water Mark
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#202-rolling-window" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.2 Rolling Window
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#203-date-format-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        20.3 Date Format Handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#21-diagnostics-diff-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        21. Diagnostics &amp; Diff Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="21. Diagnostics &amp; Diff Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-delta-table-diff" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1 Delta Table Diff
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-run-diff" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.2 Run Diff
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-cross-check-transformer" class="md-nav__link">
    <span class="md-ellipsis">
      
        22. Cross-Check Transformer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#23-testing-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        23. Testing Utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="23. Testing Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231-test-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      
        23.1 Test Fixtures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232-assertions" class="md-nav__link">
    <span class="md-ellipsis">
      
        23.2 Assertions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24-derived-updater-internal" class="md-nav__link">
    <span class="md-ellipsis">
      
        24. Derived Updater (Internal)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#25-extension-points" class="md-nav__link">
    <span class="md-ellipsis">
      
        25. Extension Points
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="25. Extension Points">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251-custom-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        25.1 Custom Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252-custom-connections" class="md-nav__link">
    <span class="md-ellipsis">
      
        25.2 Custom Connections
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#253-plugin-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        25.3 Plugin System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#26-quick-reference-cheat-sheet" class="md-nav__link">
    <span class="md-ellipsis">
      
        26. Quick Reference Cheat Sheet
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="26. Quick Reference Cheat Sheet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yaml-node-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        YAML Node Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-transform-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Transform Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-node-results-spark" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Node Results (Spark)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation Quick Reference
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delta-lake-quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Delta Lake Quick Reference
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alerts-quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alerts Quick Reference
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Connection Quick Reference
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#27-documentation-map" class="md-nav__link">
    <span class="md-ellipsis">
      
        27. Documentation Map
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="27. Documentation Map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Reference
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patterns-16-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Patterns (16 docs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guides-21-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Guides (21 docs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#features-22-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Features (22 docs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorials-19-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tutorials (19 docs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-phases-14-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Phases (14 docs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples-10-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples (10 docs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-4-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation (4 docs)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#semantic-layer-6-docs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Semantic Layer (6 docs)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/connections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="odibi-deep-context">Odibi Deep Context<a class="headerlink" href="#odibi-deep-context" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>What is Odibi?</strong> A Python data pipeline framework for building enterprise data warehouses. It orchestrates nodes (read → transform → validate → write) with dependency resolution, supports Pandas/Spark/Polars engines, and provides patterns for common DWH tasks (SCD2, dimension tables, fact tables, merges).</p>
</blockquote>
<p><strong>Target User:</strong> Solo data engineer or small team building data pipelines without dedicated infrastructure support.</p>
<p><strong>Core Philosophy:</strong> YAML-first configuration, engine parity (same YAML works on Pandas/Spark), patterns for DWH best practices.</p>
<blockquote>
<p><strong>💡 AI/LLM Tip:</strong> Use CLI introspection to discover features programmatically:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>odibi<span class="w"> </span>list<span class="w"> </span>transformers<span class="w"> </span>--format<span class="w"> </span>json<span class="w">   </span><span class="c1"># All 52+ transformers</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>odibi<span class="w"> </span>list<span class="w"> </span>patterns<span class="w"> </span>--format<span class="w"> </span>json<span class="w">       </span><span class="c1"># All 6 patterns</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>odibi<span class="w"> </span>explain<span class="w"> </span>&lt;name&gt;<span class="w">                    </span><span class="c1"># Detailed docs + example YAML</span>
</code></pre></div></p>
</blockquote>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#1-critical-runtime-behavior">Critical Runtime Behavior</a></li>
<li><a href="#2-core-execution-model">Core Execution Model</a></li>
<li><a href="#3-patterns-reference">Patterns Reference</a></li>
<li><a href="#4-transformers-reference">Transformers Reference</a></li>
<li><a href="#5-validation--quarantine">Validation &amp; Quarantine</a></li>
<li><a href="#6-connections-reference">Connections Reference</a></li>
<li><a href="#7-write-configuration-delta-lake-features">Write Configuration (Delta Lake Features)</a></li>
<li><a href="#8-alerts--notifications">Alerts &amp; Notifications</a></li>
<li><a href="#9-system-catalog-the-brain">System Catalog (The Brain)</a></li>
<li><a href="#10-openlineage-integration">OpenLineage Integration</a></li>
<li><a href="#11-foreign-key-validation">Foreign Key Validation</a></li>
<li><a href="#12-orchestration-export">Orchestration Export</a></li>
<li><a href="#13-manufacturing-transformers">Manufacturing Transformers</a></li>
<li><a href="#14-semantic-layer">Semantic Layer</a></li>
<li><a href="#15-story-generation">Story Generation</a></li>
<li><a href="#16-common-workflows">Common Workflows</a></li>
<li><a href="#17-cli-reference">CLI Reference</a></li>
<li><a href="#18-anti-patterns-and-gotchas">Anti-Patterns and Gotchas</a></li>
<li><a href="#19-sql-server-writer">SQL Server Writer</a></li>
<li><a href="#20-incremental-loading-advanced">Incremental Loading (Advanced)</a></li>
<li><a href="#21-diagnostics--diff-tools">Diagnostics &amp; Diff Tools</a></li>
<li><a href="#22-cross-check-transformer">Cross-Check Transformer</a></li>
<li><a href="#23-testing-utilities">Testing Utilities</a></li>
<li><a href="#24-derived-updater-internal">Derived Updater (Internal)</a></li>
<li><a href="#25-extension-points">Extension Points</a></li>
<li><a href="#26-quick-reference-cheat-sheet">Quick Reference Cheat Sheet</a></li>
<li><a href="#27-documentation-map">Documentation Map</a></li>
</ol>
<hr />
<h2 id="1-critical-runtime-behavior">1. Critical Runtime Behavior<a class="headerlink" href="#1-critical-runtime-behavior" title="Permanent link">&para;</a></h2>
<h3 id="11-spark-temp-view-registration-most-important">1.1 Spark Temp View Registration (MOST IMPORTANT)<a class="headerlink" href="#11-spark-temp-view-registration-most-important" title="Permanent link">&para;</a></h3>
<p>When using PipelineManager with <strong>Spark engine</strong>, each node's output DataFrame is registered as a Spark temp view:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># In odibi/context.py, SparkContext.register() at line 432:</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">df</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
<p><strong>You can query any node's output with:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM node_name&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Constraints:</strong>
- <strong>Node names must be alphanumeric + underscore only</strong> (no spaces, hyphens, dots)
- Validated by <code>SparkContext._validate_name()</code> with regex <code>^[a-zA-Z0-9_]+$</code>
- Invalid names raise <code>ValueError</code>: <em>"Invalid node name 'X' for Spark engine. Names must contain only alphanumeric characters and underscores"</em></p>
<p><strong>Lifecycle:</strong>
- Views persist for duration of pipeline execution
- Tracked in <code>SparkContext._registered_views: set[str]</code>
- Cleaned up via <code>context.clear()</code> which calls <code>spark.catalog.dropTempView(name)</code>
- Thread-safe: Uses <code>threading.RLock()</code> for concurrent access</p>
<p><strong>How to list registered views:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># From context</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">context</span><span class="o">.</span><span class="n">list_names</span><span class="p">()</span>  <span class="c1"># Returns list of registered DataFrame names</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># From SparkSession</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">listTables</span><span class="p">()</span>
</code></pre></div></p>
<p><strong>How to get a DataFrame back:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Via context</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node_name&quot;</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># Via Spark (equivalent)</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">&quot;node_name&quot;</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="12-pandas-context-behavior">1.2 Pandas Context Behavior<a class="headerlink" href="#12-pandas-context-behavior" title="Permanent link">&para;</a></h3>
<p>With <strong>Pandas engine</strong>, DataFrames are stored in an in-memory dictionary:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># odibi/context.py, PandasContext at line 209:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></p>
<ul>
<li><strong>No temp views</strong> - data accessed via <code>context.get(name)</code></li>
<li>SQL operations use <strong>DuckDB</strong> under the hood (not Spark SQL)</li>
<li>The <code>context.sql(query)</code> method:</li>
<li>Registers current DataFrame as a unique temp view</li>
<li>Replaces <code>df</code> references in query with that view name</li>
<li>Executes via DuckDB</li>
<li>Cleans up temp view</li>
</ul>
<p><strong>DuckDB vs Spark SQL differences:</strong>
| Feature | Pandas (DuckDB) | Spark |
|---------|-----------------|-------|
| Exclude columns | <code>SELECT * EXCLUDE (col)</code> | <code>SELECT * EXCEPT (col)</code> |
| Row number | <code>ROW_NUMBER() OVER (...)</code> | Same |
| Array explode | <code>UNNEST(arr)</code> | <code>explode(arr)</code> |</p>
<h3 id="13-polars-context-behavior">1.3 Polars Context Behavior<a class="headerlink" href="#13-polars-context-behavior" title="Permanent link">&para;</a></h3>
<p>Similar to Pandas - in-memory dictionary storage:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># odibi/context.py, PolarsContext:</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Stores pl.DataFrame or pl.LazyFrame</span>
</code></pre></div></p>
<ul>
<li>Supports both eager (<code>DataFrame</code>) and lazy (<code>LazyFrame</code>) evaluation</li>
<li>Limited SQL support compared to Pandas/Spark</li>
</ul>
<h3 id="14-data-flow-between-nodes">1.4 Data Flow Between Nodes<a class="headerlink" href="#14-data-flow-between-nodes" title="Permanent link">&para;</a></h3>
<p>When Node B depends on Node A:</p>
<ol>
<li>Node A completes → output DataFrame registered via <code>context.register(name, df)</code></li>
<li>Node B starts → gets input via <code>context.get("node_a")</code></li>
<li><strong>For Spark:</strong> Node B can also use <code>spark.sql("SELECT * FROM node_a")</code></li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># YAML declaration</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node_b</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">node_a</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Explicit dependency (required for execution order)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">      </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node_a</span><span class="w">      </span><span class="c1"># How to reference the data</span>
</code></pre></div>
<p><strong>Cross-Pipeline References:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">inputs</span><span class="p">:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nt">customers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$other_pipeline.customer_node</span><span class="w">  </span><span class="c1"># Reference node from another pipeline</span>
</code></pre></div></p>
<hr />
<h2 id="2-core-execution-model">2. Core Execution Model<a class="headerlink" href="#2-core-execution-model" title="Permanent link">&para;</a></h2>
<h3 id="21-pipeline-execution-flow">2.1 Pipeline Execution Flow<a class="headerlink" href="#21-pipeline-execution-flow" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>PipelineManager.run()
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    │
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    ├── 1. Load project.yaml + pipeline.yaml
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    ├── 2. Build DependencyGraph (topological sort)
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    ├── 3. Create Context (Pandas/Spark/Polars)
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    ├── 4. Register standard transformers
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    │
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    └── 5. For each node in execution order:
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>            │
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>            ├── PRE-SQL: Execute pre_sql statements
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>            ├── READ: Load data from source/connection
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>            │   └── Apply incremental filter if configured
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>            ├── TRANSFORM: Apply transformers/patterns in order
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>            ├── VALIDATE: Run quality checks
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>            │   ├── Tests with on_fail=FAIL → stop pipeline
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>            │   ├── Tests with on_fail=WARN → log warning
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>            │   └── Tests with on_fail=QUARANTINE → route to quarantine table
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>            ├── WRITE: Persist to target
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>            │   └── Add metadata columns if configured
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>            └── REGISTER: context.register(node_name, df)
</code></pre></div>
<p><strong>Key Classes:</strong>
| Class | File | Role |
|-------|------|------|
| <code>Pipeline</code> | <code>odibi/pipeline.py</code> | Orchestrates execution, manages state |
| <code>PipelineManager</code> | <code>odibi/pipeline.py</code> | Entry point, loads config, creates Pipeline |
| <code>Node</code> | <code>odibi/node.py</code> | Single unit of work |
| <code>NodeExecutor</code> | <code>odibi/node.py</code> | Executes read/transform/validate/write |
| <code>DependencyGraph</code> | <code>odibi/graph.py</code> | Resolves execution order |
| <code>Context</code> | <code>odibi/context.py</code> | Stores DataFrames between nodes |</p>
<h3 id="22-node-execution-phases">2.2 Node Execution Phases<a class="headerlink" href="#22-node-execution-phases" title="Permanent link">&para;</a></h3>
<p>Each node goes through these phases (tracked by <code>PhaseTimer</code>):</p>
<table>
<thead>
<tr>
<th>Phase</th>
<th>What Happens</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pre_sql</code></td>
<td>Execute SQL statements before read</td>
</tr>
<tr>
<td><code>read</code></td>
<td>Load data from connection/input</td>
</tr>
<tr>
<td><code>incremental_filter</code></td>
<td>Apply HWM or rolling window filter</td>
</tr>
<tr>
<td><code>transform</code></td>
<td>Apply each transformer in order</td>
</tr>
<tr>
<td><code>validate</code></td>
<td>Run validation tests</td>
</tr>
<tr>
<td><code>quarantine</code></td>
<td>Route failed rows if configured</td>
</tr>
<tr>
<td><code>gate</code></td>
<td>Evaluate quality gates</td>
</tr>
<tr>
<td><code>write</code></td>
<td>Persist to destination</td>
</tr>
<tr>
<td><code>post_sql</code></td>
<td>Execute SQL statements after write</td>
</tr>
</tbody>
</table>
<h3 id="23-error-handling-strategies">2.3 Error Handling Strategies<a class="headerlink" href="#23-error-handling-strategies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># In pipeline.yaml or CLI</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nt">error_strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fail_fast</span><span class="w">  </span><span class="c1"># Options: fail_fast, fail_later, ignore</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Behavior</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fail_fast</code></td>
<td>Stop immediately on first error</td>
<td>Development, critical pipelines</td>
</tr>
<tr>
<td><code>fail_later</code></td>
<td>Continue (dependents skipped), fail at end</td>
<td>Batch processing, partial success OK</td>
</tr>
<tr>
<td><code>ignore</code></td>
<td>Log errors, continue (dependents run)</td>
<td>Non-critical, alerting-only</td>
</tr>
</tbody>
</table>
<h3 id="24-retry-configuration">2.4 Retry Configuration<a class="headerlink" href="#24-retry-configuration" title="Permanent link">&para;</a></h3>
<p>Automatic retry on transient failures. Backoff strategy controls delay between attempts.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nt">retry</span><span class="p">:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">           </span><span class="c1"># Enable/disable automatic retry (default: true)</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nt">max_attempts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">         </span><span class="c1"># 1-10 attempts (default: 3)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">backoff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exponential</span><span class="w">    </span><span class="c1"># exponential (2^n sec), linear (n sec), constant (1 sec)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Backoff Strategy</th>
<th>Delay Pattern</th>
<th>Example (3 attempts)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exponential</code></td>
<td>2^n seconds</td>
<td>2s, 4s, 8s</td>
</tr>
<tr>
<td><code>linear</code></td>
<td>n seconds</td>
<td>1s, 2s, 3s</td>
</tr>
<tr>
<td><code>constant</code></td>
<td>Fixed 1 second</td>
<td>1s, 1s, 1s</td>
</tr>
</tbody>
</table>
<h3 id="25-context-factory">2.5 Context Factory<a class="headerlink" href="#25-context-factory" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_context</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="c1"># Create appropriate context</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">context</span> <span class="o">=</span> <span class="n">create_context</span><span class="p">(</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>  <span class="c1"># Returns PandasContext</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">context</span> <span class="o">=</span> <span class="n">create_context</span><span class="p">(</span><span class="s2">&quot;spark&quot;</span><span class="p">,</span> <span class="n">spark_session</span><span class="o">=</span><span class="n">spark</span><span class="p">)</span>  <span class="c1"># Returns SparkContext</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">context</span> <span class="o">=</span> <span class="n">create_context</span><span class="p">(</span><span class="s2">&quot;polars&quot;</span><span class="p">)</span>  <span class="c1"># Returns PolarsContext</span>
</code></pre></div>
<hr />
<h2 id="3-patterns-reference">3. Patterns Reference<a class="headerlink" href="#3-patterns-reference" title="Permanent link">&para;</a></h2>
<p>Patterns are high-level abstractions for common DWH operations. They encapsulate complex logic into declarative configuration.</p>
<h3 id="31-dimension-pattern">3.1 Dimension Pattern<a class="headerlink" href="#31-dimension-pattern" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Create dimension tables with surrogate keys for star schema.</p>
<p><strong>Class:</strong> <code>DimensionPattern</code> in <code>odibi/patterns/dimension.py</code></p>
<p><strong>Features:</strong>
- Auto-generate integer surrogate keys (MAX + ROW_NUMBER)
- SCD Type 0 (static), 1 (overwrite), 2 (history tracking)
- Optional unknown member row (SK=0) for orphan FK handling
- Audit columns (load_timestamp, source_system)</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>natural_key</code></td>
<td>str/list</td>
<td>Yes</td>
<td>-</td>
<td>Business key column(s)</td>
</tr>
<tr>
<td><code>surrogate_key</code></td>
<td>str</td>
<td>Yes</td>
<td>-</td>
<td>Name for generated SK column</td>
</tr>
<tr>
<td><code>scd_type</code></td>
<td>int</td>
<td>No</td>
<td>1</td>
<td>0=static, 1=overwrite, 2=history</td>
</tr>
<tr>
<td><code>track_cols</code></td>
<td>list</td>
<td>For SCD1/2</td>
<td>-</td>
<td>Columns to monitor for changes</td>
</tr>
<tr>
<td><code>target</code></td>
<td>str</td>
<td>For SCD2</td>
<td>-</td>
<td>Path to existing dimension</td>
</tr>
<tr>
<td><code>unknown_member</code></td>
<td>bool</td>
<td>No</td>
<td>False</td>
<td>Add SK=0 unknown row</td>
</tr>
<tr>
<td><code>audit.load_timestamp</code></td>
<td>bool</td>
<td>No</td>
<td>True</td>
<td>Add load timestamp</td>
</tr>
<tr>
<td><code>audit.source_system</code></td>
<td>str</td>
<td>No</td>
<td>None</td>
<td>Source system name</td>
</tr>
</tbody>
</table>
<p><strong>YAML Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">pattern</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dimension</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="nt">natural_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="nt">surrogate_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_sk</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="nt">scd_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="nt">track_cols</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">name</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">email</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tier</span><span class="p p-Indicator">]</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="nt">unknown_member</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="nt">audit</span><span class="p">:</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">      </span><span class="nt">load_timestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">      </span><span class="nt">source_system</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crm</span>
</code></pre></div></p>
<p><strong>Output Schema Changes:</strong>
- Adds: <code>{surrogate_key}</code> column (integer, starts at 1)
- Adds: <code>_load_timestamp</code> (if audit.load_timestamp=true)
- Adds: <code>_source_system</code> (if audit.source_system set)
- SCD2 adds: <code>valid_from</code>, <code>valid_to</code>, <code>is_current</code>
- Unknown member: Row with SK=0, natural_key=-1 or "UNKNOWN"</p>
<hr />
<h3 id="32-fact-pattern">3.2 Fact Pattern<a class="headerlink" href="#32-fact-pattern" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Build fact tables with foreign key lookups to dimensions.</p>
<p><strong>Class:</strong> <code>FactPattern</code> in <code>odibi/patterns/fact.py</code></p>
<p><strong>Features:</strong>
- Automatic surrogate key lookups from dimension tables
- Orphan handling (unknown member, reject, quarantine)
- Grain validation (detect duplicates)
- Measure calculations
- Deduplication</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grain</code></td>
<td>list</td>
<td>No</td>
<td>Columns defining uniqueness (validates no duplicates)</td>
</tr>
<tr>
<td><code>dimensions</code></td>
<td>list</td>
<td>No</td>
<td>Dimension lookup configurations</td>
</tr>
<tr>
<td><code>orphan_handling</code></td>
<td>str</td>
<td>No</td>
<td><code>unknown</code>, <code>reject</code>, <code>quarantine</code> (default: unknown)</td>
</tr>
<tr>
<td><code>quarantine</code></td>
<td>dict</td>
<td>If orphan=quarantine</td>
<td>Quarantine destination config</td>
</tr>
<tr>
<td><code>measures</code></td>
<td>list</td>
<td>No</td>
<td>Measure column definitions</td>
</tr>
<tr>
<td><code>deduplicate</code></td>
<td>bool</td>
<td>No</td>
<td>Remove duplicates (requires <code>keys</code>)</td>
</tr>
<tr>
<td><code>keys</code></td>
<td>list</td>
<td>If deduplicate</td>
<td>Deduplication keys</td>
</tr>
<tr>
<td><code>audit</code></td>
<td>dict</td>
<td>No</td>
<td>Audit column configuration</td>
</tr>
</tbody>
</table>
<p><strong>Dimension Lookup Structure:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">dimensions</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span><span class="w">      </span><span class="c1"># FK column in fact</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="nt">dimension_table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customer</span><span class="w">   </span><span class="c1"># Dimension node name in context</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="nt">dimension_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span><span class="w">      </span><span class="c1"># NK column in dimension</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="nt">surrogate_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_sk</span><span class="w">      </span><span class="c1"># SK to retrieve</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="nt">scd2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">                      </span><span class="c1"># Filter is_current=true (optional)</span>
</code></pre></div></p>
<p><strong>YAML Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">pattern</span><span class="p">:</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nt">grain</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">order_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="nt">dimensions</span><span class="p">:</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">        </span><span class="nt">dimension_table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customer</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">        </span><span class="nt">dimension_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_id</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">        </span><span class="nt">surrogate_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_sk</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">        </span><span class="nt">scd2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source_column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">product_id</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="nt">dimension_table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_product</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">        </span><span class="nt">dimension_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">product_id</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">        </span><span class="nt">surrogate_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">product_sk</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="nt">orphan_handling</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unknown</span><span class="w">  </span><span class="c1"># Orphans get SK=0</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">    </span><span class="nt">measures</span><span class="p">:</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quantity</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total_amount</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">profit</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;total_amount</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">cost&quot;</span><span class="w">  </span><span class="c1"># Calculated measure</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="nt">audit</span><span class="p">:</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">      </span><span class="nt">load_timestamp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">      </span><span class="nt">source_system</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pos</span>
</code></pre></div></p>
<p><strong>Orphan Handling Options:</strong>
| Mode | Behavior |
|------|----------|
| <code>unknown</code> | Assign SK=0 (requires unknown member in dimension) |
| <code>reject</code> | Filter out orphan rows |
| <code>quarantine</code> | Route orphans to separate table |</p>
<hr />
<h3 id="33-scd2-pattern-transformer">3.3 SCD2 Pattern (Transformer)<a class="headerlink" href="#33-scd2-pattern-transformer" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Maintain full history of changes with effective date ranges.</p>
<p><strong>Class:</strong> <code>SCD2Params</code> in <code>odibi/transformers/scd.py</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>target</code></td>
<td>str</td>
<td>Yes*</td>
<td>Table name or path</td>
</tr>
<tr>
<td><code>connection</code></td>
<td>str</td>
<td>Yes*</td>
<td>Connection name (with <code>path</code>)</td>
</tr>
<tr>
<td><code>path</code></td>
<td>str</td>
<td>Yes*</td>
<td>Relative path within connection</td>
</tr>
<tr>
<td><code>keys</code></td>
<td>list</td>
<td>Yes</td>
<td>Natural key columns</td>
</tr>
<tr>
<td><code>track_cols</code></td>
<td>list</td>
<td>Yes</td>
<td>Columns to monitor for changes</td>
</tr>
<tr>
<td><code>effective_time_col</code></td>
<td>str</td>
<td>Yes</td>
<td>Source column with change timestamp</td>
</tr>
<tr>
<td><code>start_time_col</code></td>
<td>str</td>
<td>No</td>
<td>Default: <code>valid_from</code>. Renamed from effective_time_col in target.</td>
</tr>
<tr>
<td><code>end_time_col</code></td>
<td>str</td>
<td>No</td>
<td>Default: <code>valid_to</code></td>
</tr>
<tr>
<td><code>current_flag_col</code></td>
<td>str</td>
<td>No</td>
<td>Default: <code>is_current</code></td>
</tr>
<tr>
<td><code>delete_col</code></td>
<td>str</td>
<td>No</td>
<td>Column indicating soft deletion</td>
</tr>
</tbody>
</table>
<p>*Either <code>target</code> OR <code>connection</code>+<code>path</code> required, not both.</p>
<p><strong>YAML Example (Table Name):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">transformer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scd2</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver.dim_customers</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="nt">track_cols</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">address</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tier</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">email</span><span class="p p-Indicator">]</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="nt">effective_time_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
</code></pre></div></p>
<p><strong>YAML Example (Connection + Path):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nt">transformer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scd2</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">adls_prod</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OEE/silver/dim_customers</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="nt">track_cols</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">address</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tier</span><span class="p p-Indicator">]</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="nt">effective_time_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">txn_date</span>
</code></pre></div></p>
<p><strong>How It Works:</strong>
1. <strong>Match</strong>: Find existing records using <code>keys</code>
2. <strong>Compare</strong>: Check <code>track_cols</code> for changes (uses <code>IS DISTINCT FROM</code> for null-safe comparison)
3. <strong>Close</strong>: Update old record's <code>valid_to</code> to the effective time, set <code>is_current=False</code>
4. <strong>Insert</strong>: Add new record with <code>valid_from</code> (renamed from <code>effective_time_col</code>), <code>valid_to=NULL</code>, <code>is_current=True</code></p>
<p><strong>Note:</strong> SCD2 is self-contained — it writes directly to the target table on all engines. No <code>write:</code> block is needed.</p>
<hr />
<h3 id="34-merge-pattern-transformer">3.4 Merge Pattern (Transformer)<a class="headerlink" href="#34-merge-pattern-transformer" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Upsert, append, or delete records in target table.</p>
<p><strong>Class:</strong> <code>MergeTransformer</code> in <code>odibi/transformers/merge_transformer.py</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>target</code></td>
<td>str</td>
<td>Yes</td>
<td>Target table/path</td>
</tr>
<tr>
<td><code>keys</code></td>
<td>list</td>
<td>Yes</td>
<td>Match keys for merge</td>
</tr>
<tr>
<td><code>strategy</code></td>
<td>str</td>
<td>No</td>
<td><code>upsert</code>, <code>append_only</code>, <code>delete_match</code></td>
</tr>
<tr>
<td><code>created_col</code></td>
<td>str</td>
<td>No</td>
<td>Audit column for inserts</td>
</tr>
<tr>
<td><code>updated_col</code></td>
<td>str</td>
<td>No</td>
<td>Audit column for updates</td>
</tr>
<tr>
<td><code>soft_delete_col</code></td>
<td>str</td>
<td>No</td>
<td>Column for soft delete flag</td>
</tr>
<tr>
<td><code>optimize_write</code></td>
<td>bool</td>
<td>No</td>
<td>Run OPTIMIZE after merge (Spark only)</td>
</tr>
<tr>
<td><code>vacuum_hours</code></td>
<td>int</td>
<td>No</td>
<td>Hours to retain for VACUUM (Spark only). 168 = 7 days.</td>
</tr>
<tr>
<td><code>zorder_by</code></td>
<td>list</td>
<td>No</td>
<td>Columns to Z-ORDER by after merge</td>
</tr>
</tbody>
</table>
<p><strong>Strategies:</strong>
| Strategy | Behavior |
|----------|----------|
| <code>upsert</code> | Insert new, update existing |
| <code>append_only</code> | Insert new only, ignore existing |
| <code>delete_match</code> | Delete target rows matching source keys |</p>
<p><strong>YAML Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nt">transformer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merge</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver.products</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">product_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">upsert</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span><span class="nt">updated_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_updated_at</span>
</code></pre></div></p>
<hr />
<h3 id="35-aggregation-pattern">3.5 Aggregation Pattern<a class="headerlink" href="#35-aggregation-pattern" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Group and aggregate data with optional time rollups and incremental merging.</p>
<p><strong>Class:</strong> <code>AggregationPattern</code> in <code>odibi/patterns/aggregation.py</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grain</code></td>
<td>list</td>
<td>Yes</td>
<td>Group by columns</td>
</tr>
<tr>
<td><code>measures</code></td>
<td>list</td>
<td>Yes</td>
<td>SQL aggregation expressions</td>
</tr>
<tr>
<td><code>time_rollup</code></td>
<td>str</td>
<td>No</td>
<td><code>daily</code>, <code>weekly</code>, <code>monthly</code></td>
</tr>
<tr>
<td><code>merge_strategy</code></td>
<td>str</td>
<td>No</td>
<td><code>replace</code>, <code>sum</code>, <code>min</code>, <code>max</code></td>
</tr>
<tr>
<td><code>having</code></td>
<td>str</td>
<td>No</td>
<td>HAVING clause filter</td>
</tr>
<tr>
<td><code>audit_config</code></td>
<td>dict</td>
<td>No</td>
<td>Add <code>load_timestamp</code>, <code>source_system</code></td>
</tr>
</tbody>
</table>
<p><strong>YAML Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nt">pattern</span><span class="p">:</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aggregation</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nt">grain</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">date_sk</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">product_sk</span><span class="p p-Indicator">]</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="nt">measures</span><span class="p">:</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;SUM(amount)</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">total_amount&quot;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;COUNT(*)</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">transaction_count&quot;</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;AVG(unit_price)</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">avg_price&quot;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="nt">having</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;COUNT(*)</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">10&quot;</span>
</code></pre></div></p>
<hr />
<h3 id="36-date-dimension-pattern">3.6 Date Dimension Pattern<a class="headerlink" href="#36-date-dimension-pattern" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Generate a complete date dimension table.</p>
<p><strong>Class:</strong> <code>DateDimensionPattern</code> in <code>odibi/patterns/date_dimension.py</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start_date</code></td>
<td>str</td>
<td>Yes</td>
<td>Start date (YYYY-MM-DD)</td>
</tr>
<tr>
<td><code>end_date</code></td>
<td>str</td>
<td>Yes</td>
<td>End date (YYYY-MM-DD)</td>
</tr>
<tr>
<td><code>fiscal_year_start_month</code></td>
<td>int</td>
<td>No</td>
<td>Fiscal year start (1-12)</td>
</tr>
<tr>
<td><code>week_start_day</code></td>
<td>int</td>
<td>No</td>
<td>Week start (0=Mon, 6=Sun)</td>
</tr>
<tr>
<td><code>holidays</code></td>
<td>list</td>
<td>No</td>
<td>Holiday dates or calendar name</td>
</tr>
</tbody>
</table>
<p><strong>YAML Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nt">pattern</span><span class="p">:</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">date_dimension</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="nt">start_date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2020-01-01&quot;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="nt">end_date</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2030-12-31&quot;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="nt">fiscal_year_start_month</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="nt">week_start_day</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</code></pre></div></p>
<p><strong>Output Columns:</strong>
- <code>date_sk</code> (int): Surrogate key (YYYYMMDD format)
- <code>date_key</code> (date): Date value
- <code>full_date</code> (str): Full date string
- <code>year</code>, <code>quarter</code>, <code>month</code>, <code>day</code>
- <code>day_of_week</code>, <code>day_of_week_name</code>
- <code>week_of_year</code>, <code>month_name</code>
- <code>is_weekend</code>, <code>is_holiday</code>
- <code>fiscal_year</code>, <code>fiscal_quarter</code>, <code>fiscal_month</code></p>
<hr />
<h2 id="4-transformers-reference">4. Transformers Reference<a class="headerlink" href="#4-transformers-reference" title="Permanent link">&para;</a></h2>
<p>Transformers are atomic operations applied to DataFrames. All transformers work on Pandas (via DuckDB) and Spark with engine parity.</p>
<h3 id="41-sql-core-transformers">4.1 SQL Core Transformers<a class="headerlink" href="#41-sql-core-transformers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Transformer</th>
<th>Purpose</th>
<th>Key Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filter_rows</code></td>
<td>WHERE clause</td>
<td><code>condition: str</code></td>
</tr>
<tr>
<td><code>derive_columns</code></td>
<td>Add computed columns</td>
<td><code>derivations: {col: expr}</code></td>
</tr>
<tr>
<td><code>cast_columns</code></td>
<td>Change column types</td>
<td><code>casts: {col: type}</code></td>
</tr>
<tr>
<td><code>select_columns</code></td>
<td>Keep specific columns</td>
<td><code>columns: list</code></td>
</tr>
<tr>
<td><code>drop_columns</code></td>
<td>Remove columns</td>
<td><code>columns: list</code></td>
</tr>
<tr>
<td><code>rename_columns</code></td>
<td>Rename columns</td>
<td><code>mapping: {old: new}</code></td>
</tr>
<tr>
<td><code>sort</code></td>
<td>Order rows</td>
<td><code>by: list</code>, <code>ascending: bool</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td>Limit rows</td>
<td><code>n: int</code></td>
</tr>
<tr>
<td><code>sample</code></td>
<td>Random sample</td>
<td><code>fraction: float</code> or <code>n: int</code></td>
</tr>
<tr>
<td><code>distinct</code></td>
<td>Remove duplicates</td>
<td><code>columns: list</code> (optional)</td>
</tr>
<tr>
<td><code>fill_nulls</code></td>
<td>Replace nulls</td>
<td><code>columns: list</code>, <code>value: any</code></td>
</tr>
<tr>
<td><code>clean_text</code></td>
<td>Trim/case transform</td>
<td><code>columns</code>, <code>trim</code>, <code>case</code></td>
</tr>
<tr>
<td><code>case_when</code></td>
<td>Conditional logic</td>
<td><code>conditions: list</code>, <code>output_col</code></td>
</tr>
<tr>
<td><code>coalesce_columns</code></td>
<td>First non-null</td>
<td><code>columns</code>, <code>output_col</code></td>
</tr>
<tr>
<td><code>concat_columns</code></td>
<td>String concatenation</td>
<td><code>columns</code>, <code>output_col</code>, <code>separator</code></td>
</tr>
<tr>
<td><code>normalize_column_names</code></td>
<td>Clean column names</td>
<td><code>style</code>, <code>lowercase</code>, <code>remove_special</code></td>
</tr>
<tr>
<td><code>replace_values</code></td>
<td>Bulk value replacement</td>
<td><code>columns</code>, <code>mapping</code></td>
</tr>
<tr>
<td><code>trim_whitespace</code></td>
<td>Trim all string columns</td>
<td><code>columns</code> (optional)</td>
</tr>
<tr>
<td><code>add_prefix</code></td>
<td>Add column prefix</td>
<td><code>prefix</code>, <code>columns</code></td>
</tr>
<tr>
<td><code>add_suffix</code></td>
<td>Add column suffix</td>
<td><code>suffix</code>, <code>columns</code></td>
</tr>
<tr>
<td><code>split_part</code></td>
<td>Split string</td>
<td><code>column</code>, <code>delimiter</code>, <code>part</code></td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">filter_rows</span><span class="p">:</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;status</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;active&#39;</span><span class="nv"> </span><span class="s">AND</span><span class="nv"> </span><span class="s">amount</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0&quot;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">derive_columns</span><span class="p">:</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">      </span><span class="nt">derivations</span><span class="p">:</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">        </span><span class="nt">total_price</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;quantity</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">unit_price&quot;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">        </span><span class="nt">full_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;concat(first_name,</span><span class="nv"> </span><span class="s">&#39;</span><span class="nv"> </span><span class="s">&#39;,</span><span class="nv"> </span><span class="s">last_name)&quot;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cast_columns</span><span class="p">:</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">      </span><span class="nt">casts</span><span class="p">:</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">        </span><span class="nt">created_at</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timestamp</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">        </span><span class="nt">amount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">double</span>
</code></pre></div></p>
<h3 id="42-date-transformers">4.2 Date Transformers<a class="headerlink" href="#42-date-transformers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Transformer</th>
<th>Purpose</th>
<th>Key Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>extract_date_parts</code></td>
<td>Extract year/month/day</td>
<td><code>column</code>, <code>parts: list</code></td>
</tr>
<tr>
<td><code>date_add</code></td>
<td>Add interval</td>
<td><code>column</code>, <code>days</code>/<code>months</code>/<code>years</code>, <code>output_col</code></td>
</tr>
<tr>
<td><code>date_diff</code></td>
<td>Difference between dates</td>
<td><code>start_col</code>, <code>end_col</code>, <code>unit</code>, <code>output_col</code></td>
</tr>
<tr>
<td><code>date_trunc</code></td>
<td>Truncate to unit</td>
<td><code>column</code>, <code>unit</code></td>
</tr>
<tr>
<td><code>convert_timezone</code></td>
<td>TZ conversion</td>
<td><code>column</code>, <code>from_tz</code>, <code>to_tz</code></td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">extract_date_parts</span><span class="p">:</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_date</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">      </span><span class="nt">parts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">year</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">month</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">day_of_week</span><span class="p p-Indicator">]</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">date_diff</span><span class="p">:</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">      </span><span class="nt">start_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start_date</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">      </span><span class="nt">end_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">end_date</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">      </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">days</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">      </span><span class="nt">output_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">duration_days</span>
</code></pre></div></p>
<h3 id="43-relational-transformers">4.3 Relational Transformers<a class="headerlink" href="#43-relational-transformers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Transformer</th>
<th>Purpose</th>
<th>Key Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>join</code></td>
<td>Join datasets</td>
<td><code>right_dataset</code>, <code>on</code>, <code>how</code>, <code>prefix</code></td>
</tr>
<tr>
<td><code>union</code></td>
<td>Stack datasets</td>
<td><code>datasets: list</code>, <code>by_name: bool</code></td>
</tr>
<tr>
<td><code>aggregate</code></td>
<td>Group by</td>
<td><code>group_by: list</code>, <code>aggregations: dict</code></td>
</tr>
<tr>
<td><code>pivot</code></td>
<td>Rows to columns</td>
<td><code>group_by</code>, <code>pivot_col</code>, <code>agg_col</code>, <code>agg_func</code></td>
</tr>
<tr>
<td><code>unpivot</code></td>
<td>Columns to rows</td>
<td><code>id_cols</code>, <code>value_vars</code>, <code>var_name</code>, <code>value_name</code></td>
</tr>
</tbody>
</table>
<p><strong>Join Types:</strong> <code>inner</code>, <code>left</code>, <code>right</code>, <code>full</code>, <code>cross</code>, <code>anti</code>, <code>semi</code></p>
<p><strong>Join Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">join</span><span class="p">:</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">      </span><span class="nt">right_dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customer</span><span class="w">  </span><span class="c1"># Must be in depends_on!</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">      </span><span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">      </span><span class="nt">how</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">left</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cust</span><span class="w">  </span><span class="c1"># Avoid column collisions → cust_name, cust_email</span>
</code></pre></div></p>
<p><strong>Aggregate Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">aggregate</span><span class="p">:</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">      </span><span class="nt">group_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">department</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">region</span><span class="p p-Indicator">]</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">      </span><span class="nt">aggregations</span><span class="p">:</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">        </span><span class="nt">salary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">        </span><span class="nt">employee_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">count</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">        </span><span class="nt">age</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">avg</span>
</code></pre></div></p>
<h3 id="44-advanced-transformers">4.4 Advanced Transformers<a class="headerlink" href="#44-advanced-transformers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Transformer</th>
<th>Purpose</th>
<th>Key Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>deduplicate</code></td>
<td>Keep first/last per key</td>
<td><code>keys</code>, <code>order_by</code></td>
</tr>
<tr>
<td><code>explode_list_column</code></td>
<td>Flatten arrays</td>
<td><code>column</code>, <code>outer: bool</code></td>
</tr>
<tr>
<td><code>dict_based_mapping</code></td>
<td>Value replacement</td>
<td><code>column</code>, <code>mapping</code>, <code>default</code>, <code>output_column</code></td>
</tr>
<tr>
<td><code>hash_columns</code></td>
<td>Generate hash</td>
<td><code>columns</code>, <code>output_col</code>, <code>algorithm</code></td>
</tr>
<tr>
<td><code>generate_surrogate_key</code></td>
<td>UUID/hash key</td>
<td><code>columns</code>, <code>output_col</code></td>
</tr>
<tr>
<td><code>generate_numeric_key</code></td>
<td>Integer sequence</td>
<td><code>output_col</code>, <code>start</code></td>
</tr>
<tr>
<td><code>window_calculation</code></td>
<td>Window functions</td>
<td><code>partition_by</code>, <code>order_by</code>, <code>calculations</code></td>
</tr>
<tr>
<td><code>parse_json</code></td>
<td>Extract from JSON</td>
<td><code>column</code>, <code>schema</code></td>
</tr>
<tr>
<td><code>normalize_json</code></td>
<td>Flatten nested JSON</td>
<td><code>column</code>, <code>max_level</code></td>
</tr>
<tr>
<td><code>regex_replace</code></td>
<td>Regex substitution</td>
<td><code>column</code>, <code>pattern</code>, <code>replacement</code></td>
</tr>
<tr>
<td><code>unpack_struct</code></td>
<td>Flatten struct columns</td>
<td><code>column</code>, <code>prefix</code></td>
</tr>
<tr>
<td><code>sessionize</code></td>
<td>Session detection</td>
<td><code>user_col</code>, <code>timestamp_col</code>, <code>timeout</code></td>
</tr>
<tr>
<td><code>geocode</code></td>
<td>Geocode addresses</td>
<td><code>address_col</code>, <code>lat_col</code>, <code>lon_col</code></td>
</tr>
<tr>
<td><code>validate_and_flag</code></td>
<td>Flag invalid rows</td>
<td><code>validations</code>, <code>flag_col</code></td>
</tr>
<tr>
<td><code>split_events_by_period</code></td>
<td>Split time-spanning events</td>
<td><code>start_col</code>, <code>end_col</code>, <code>period</code>, <code>shifts</code></td>
</tr>
</tbody>
</table>
<p><strong>Deduplicate Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">deduplicate</span><span class="p">:</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">      </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">      </span><span class="nt">order_by</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;updated_at</span><span class="nv"> </span><span class="s">DESC&quot;</span><span class="w">  </span><span class="c1"># Keep latest</span>
</code></pre></div></p>
<p><strong>Window Calculation Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">window_calculation</span><span class="p">:</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">      </span><span class="nt">partition_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">      </span><span class="nt">order_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">order_date</span><span class="p p-Indicator">]</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">      </span><span class="nt">calculations</span><span class="p">:</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">row_number</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">          </span><span class="nt">output_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_seq</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">function</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">          </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amount</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">          </span><span class="nt">output_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">running_total</span>
</code></pre></div></p>
<h3 id="45-delete-detection-transformer">4.5 Delete Detection Transformer<a class="headerlink" href="#45-delete-detection-transformer" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> CDC-like behavior for sources without native change capture.</p>
<p><strong>Class:</strong> <code>DeleteDetectionConfig</code> in <code>odibi/config.py</code></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mode</code></td>
<td>str</td>
<td>Yes</td>
<td><code>none</code>, <code>snapshot_diff</code>, <code>sql_compare</code></td>
</tr>
<tr>
<td><code>keys</code></td>
<td>list</td>
<td>Yes</td>
<td>Primary key columns</td>
</tr>
<tr>
<td><code>soft_delete_col</code></td>
<td>str</td>
<td>No</td>
<td>Add boolean flag (default: <code>_is_deleted</code>)</td>
</tr>
<tr>
<td><code>max_delete_percent</code></td>
<td>float</td>
<td>No</td>
<td>Safety threshold (default: 50.0)</td>
</tr>
<tr>
<td><code>on_threshold_breach</code></td>
<td>str</td>
<td>No</td>
<td><code>warn</code>, <code>error</code>, <code>skip</code></td>
</tr>
<tr>
<td><code>on_first_run</code></td>
<td>str</td>
<td>No</td>
<td><code>skip</code>, <code>error</code></td>
</tr>
</tbody>
</table>
<p><strong>Modes:</strong>
| Mode | When to Use |
|------|-------------|
| <code>none</code> | Append-only facts, no delete tracking needed |
| <code>snapshot_diff</code> | Full snapshot sources (compares Delta version N vs N-1) |
| <code>sql_compare</code> | HWM incremental ingestion (queries live source) |</p>
<p><strong>Example (SQL Compare - Recommended):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nt">transformer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">detect_deletes</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql_compare</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">  </span><span class="nt">source_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure_sql</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="nt">source_table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbo.Customers</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">  </span><span class="nt">soft_delete_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_is_deleted</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">  </span><span class="nt">max_delete_percent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">  </span><span class="nt">on_threshold_breach</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">error</span>
</code></pre></div></p>
<p><strong>Example (Snapshot Diff):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nt">transformer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">detect_deletes</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snapshot_diff</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">  </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">product_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver_conn</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver/products</span>
</code></pre></div></p>
<hr />
<h2 id="5-validation-quarantine">5. Validation &amp; Quarantine<a class="headerlink" href="#5-validation-quarantine" title="Permanent link">&para;</a></h2>
<h3 id="51-validation-tests">5.1 Validation Tests<a class="headerlink" href="#51-validation-tests" title="Permanent link">&para;</a></h3>
<p>Define data quality tests in the <code>validate:</code> block:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nt">validate</span><span class="p">:</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">      </span><span class="nt">columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">order_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fail</span><span class="w">  </span><span class="c1"># fail, warn, quarantine</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unique</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">      </span><span class="nt">columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">order_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fail</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accepted_values</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">pending</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">shipped</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">delivered</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">cancelled</span><span class="p p-Indicator">]</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warn</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">range</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quantity</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">      </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarantine</span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">regex_match</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">      </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$&quot;</span>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warn</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">freshness</span>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="w">      </span><span class="nt">max_age</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;24h&quot;</span><span class="w">  </span><span class="c1"># or &quot;7d&quot;, &quot;30m&quot;</span>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fail</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">row_count</span>
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a><span class="w">      </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000000</span>
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fail</span>
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a>
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">custom_sql</span>
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">positive_amounts</span>
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;amount</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0&quot;</span>
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarantine</span>
</code></pre></div>
<p><strong>Test Types:</strong>
| Type | Purpose | Parameters |
|------|---------|------------|
| <code>not_null</code> | Check for nulls | <code>columns: list</code> |
| <code>unique</code> | Check uniqueness | <code>columns: list</code> |
| <code>accepted_values</code> | Check allowed values | <code>column</code>, <code>values: list</code> |
| <code>range</code> | Check numeric range | <code>column</code>, <code>min</code>, <code>max</code> |
| <code>regex_match</code> | Check pattern | <code>column</code>, <code>pattern</code> |
| <code>freshness</code> | Check data age | <code>column</code>, <code>max_age</code> |
| <code>row_count</code> | Check row count | <code>min</code>, <code>max</code> |
| <code>schema</code> | Check columns exist | <code>strict: bool</code> |
| <code>custom_sql</code> | Custom condition | <code>condition</code>, <code>name</code> |</p>
<p><strong>on_fail Options:</strong>
| Value | Behavior |
|-------|----------|
| <code>fail</code> | Stop pipeline with error |
| <code>warn</code> | Log warning, continue |
| <code>quarantine</code> | Route failing rows to quarantine table |</p>
<h3 id="52-quarantine-configuration">5.2 Quarantine Configuration<a class="headerlink" href="#52-quarantine-configuration" title="Permanent link">&para;</a></h3>
<p>Route failing rows to a separate table:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nt">validate</span><span class="p">:</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">range</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quantity</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarantine</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">  </span><span class="nt">quarantine</span><span class="p">:</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w">    </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quarantine/orders</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w">    </span><span class="c1"># OR: table: silver.orders_quarantine</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">    </span><span class="nt">add_columns</span><span class="p">:</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">      </span><span class="nt">rejection_reason</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">      </span><span class="c1"># &quot;_rejection_reason&quot; column</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">      </span><span class="nt">rejected_at</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">           </span><span class="c1"># &quot;_rejected_at&quot; timestamp</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">      </span><span class="nt">source_batch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">       </span><span class="c1"># &quot;_source_batch_id&quot; run ID</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w">      </span><span class="nt">failed_tests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">          </span><span class="c1"># &quot;_failed_tests&quot; list</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="w">      </span><span class="nt">original_node</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">         </span><span class="c1"># &quot;_original_node&quot; source node</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w">    </span><span class="nt">max_rows</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class="w">              </span><span class="c1"># Limit quarantine rows (optional)</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w">    </span><span class="nt">sample_fraction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w">         </span><span class="c1"># Sample quarantine rows (optional)</span>
</code></pre></div>
<p><strong>Quarantine Output Schema:</strong>
Original columns plus:
- <code>_rejection_reason</code>: Text description of failure
- <code>_rejected_at</code>: ISO timestamp
- <code>_source_batch_id</code>: Pipeline run ID
- <code>_failed_tests</code>: Comma-separated test names
- <code>_original_node</code>: Node name that failed validation</p>
<h3 id="53-quality-gates">5.3 Quality Gates<a class="headerlink" href="#53-quality-gates" title="Permanent link">&para;</a></h3>
<p>Batch-level validation that can block the entire write:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nt">validate</span><span class="p">:</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="nt">gate</span><span class="p">:</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="nt">require_pass_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.95</span><span class="w">  </span><span class="c1"># 95% of rows must pass</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="nt">thresholds</span><span class="p">:</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">        </span><span class="nt">min_pass_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.99</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accepted_values</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">        </span><span class="nt">min_pass_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.90</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span><span class="nt">row_count</span><span class="p">:</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">      </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">      </span><span class="nt">change_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span><span class="w">  </span><span class="c1"># Alert if &gt;50% change from previous run</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">    </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">abort</span><span class="w">  </span><span class="c1"># abort, warn, quarantine_all</span>
</code></pre></div>
<hr />
<h2 id="6-connections-reference">6. Connections Reference<a class="headerlink" href="#6-connections-reference" title="Permanent link">&para;</a></h2>
<h3 id="61-local-connection">6.1 Local Connection<a class="headerlink" href="#61-local-connection" title="Permanent link">&para;</a></h3>
<p><strong>Class:</strong> <code>LocalConnection</code> in <code>odibi/connections/local.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span><span class="nt">local_data</span><span class="p">:</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="nt">base_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/bronze</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>base_path</code></td>
<td>str</td>
<td>No</td>
<td><code>./data</code></td>
<td>Root directory</td>
</tr>
</tbody>
</table>
<p><strong>Supports:</strong> Local paths, <code>file://</code>, <code>dbfs:/</code> URIs</p>
<p><strong>Path Resolution:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">conn</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">&quot;silver/customers&quot;</span><span class="p">)</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1"># Local: /absolute/path/to/data/bronze/silver/customers</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="c1"># URI: dbfs:/mnt/data/silver/customers</span>
</code></pre></div></p>
<hr />
<h3 id="62-azure-adls-connection">6.2 Azure ADLS Connection<a class="headerlink" href="#62-azure-adls-connection" title="Permanent link">&para;</a></h3>
<p><strong>Class:</strong> <code>AzureADLS</code> in <code>odibi/connections/azure_adls.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">  </span><span class="nt">adls_prod</span><span class="p">:</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure_adls</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="nt">account</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mystorageaccount</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">    </span><span class="nt">container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datalake</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">    </span><span class="nt">path_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oee/prod</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="nt">auth_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">key_vault</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">    </span><span class="nt">key_vault_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-keyvault</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">    </span><span class="nt">secret_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage-key</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>account</code></td>
<td>str</td>
<td>Yes</td>
<td>Storage account name</td>
</tr>
<tr>
<td><code>container</code></td>
<td>str</td>
<td>Yes</td>
<td>Container/filesystem name</td>
</tr>
<tr>
<td><code>path_prefix</code></td>
<td>str</td>
<td>No</td>
<td>Prefix for all paths</td>
</tr>
<tr>
<td><code>auth_mode</code></td>
<td>str</td>
<td>Yes</td>
<td>Authentication mode (see below)</td>
</tr>
</tbody>
</table>
<p><strong>Auth Modes:</strong></p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Required Parameters</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key_vault</code></td>
<td><code>key_vault_name</code>, <code>secret_name</code></td>
<td>Production (recommended)</td>
</tr>
<tr>
<td><code>direct_key</code></td>
<td><code>account_key</code></td>
<td>Development only</td>
</tr>
<tr>
<td><code>sas_token</code></td>
<td><code>sas_token</code></td>
<td>Limited access scenarios</td>
</tr>
<tr>
<td><code>service_principal</code></td>
<td><code>tenant_id</code>, <code>client_id</code>, <code>client_secret</code></td>
<td>Automation/CI</td>
</tr>
<tr>
<td><code>managed_identity</code></td>
<td>(none)</td>
<td>Databricks/Azure VMs</td>
</tr>
</tbody>
</table>
<p><strong>Path Resolution:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">conn</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">&quot;silver/customers&quot;</span><span class="p">)</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="c1"># Returns: abfss://datalake@mystorageaccount.dfs.core.windows.net/oee/prod/silver/customers</span>
</code></pre></div></p>
<p><strong>Spark Configuration:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">conn</span><span class="o">.</span><span class="n">configure_spark</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>  <span class="c1"># Sets fs.azure.* configs automatically</span>
</code></pre></div></p>
<hr />
<h3 id="63-azure-sql-connection">6.3 Azure SQL Connection<a class="headerlink" href="#63-azure-sql-connection" title="Permanent link">&para;</a></h3>
<p><strong>Class:</strong> <code>AzureSQL</code> in <code>odibi/connections/azure_sql.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">  </span><span class="nt">sql_prod</span><span class="p">:</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure_sql</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myserver.database.windows.net</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analytics</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="nt">auth_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aad_msi</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>server</code></td>
<td>str</td>
<td>Yes</td>
<td>SQL server hostname</td>
</tr>
<tr>
<td><code>database</code></td>
<td>str</td>
<td>Yes</td>
<td>Database name</td>
</tr>
<tr>
<td><code>driver</code></td>
<td>str</td>
<td>No</td>
<td>Default: <code>ODBC Driver 18 for SQL Server</code></td>
</tr>
<tr>
<td><code>auth_mode</code></td>
<td>str</td>
<td>Yes</td>
<td><code>aad_msi</code>, <code>sql</code>, <code>key_vault</code></td>
</tr>
<tr>
<td><code>username</code></td>
<td>str</td>
<td>For <code>sql</code></td>
<td>SQL username</td>
</tr>
<tr>
<td><code>password</code></td>
<td>str</td>
<td>For <code>sql</code></td>
<td>SQL password</td>
</tr>
<tr>
<td><code>port</code></td>
<td>int</td>
<td>No</td>
<td>Default: 1433</td>
</tr>
</tbody>
</table>
<p><strong>Methods:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># Read data</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM dbo.Customers&quot;</span><span class="p">)</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">df</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;dbo&quot;</span><span class="p">)</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="c1"># Write data</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="n">conn</span><span class="o">.</span><span class="n">write_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;Customers&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;dbo&quot;</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="c1"># Execute statements</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;TRUNCATE TABLE dbo.Staging&quot;</span><span class="p">)</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="c1"># Spark JDBC options</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="n">options</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_spark_options</span><span class="p">()</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;jdbc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;dbtable&quot;</span><span class="p">,</span> <span class="s2">&quot;dbo.Customers&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div></p>
<hr />
<h3 id="64-http-connection">6.4 HTTP Connection<a class="headerlink" href="#64-http-connection" title="Permanent link">&para;</a></h3>
<p><strong>Class:</strong> <code>HTTPConnection</code> in <code>odibi/connections/http.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://api.example.com</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">    </span><span class="nt">headers</span><span class="p">:</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">      </span><span class="nt">User-Agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odibi-pipeline</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">    </span><span class="nt">auth</span><span class="p">:</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bearer</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">      </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${API_TOKEN}</span>
</code></pre></div>
<p><strong>Auth Modes:</strong> <code>none</code>, <code>basic</code>, <code>bearer</code>, <code>api_key</code></p>
<h3 id="65-local-dbfs-connection">6.5 Local DBFS Connection<a class="headerlink" href="#65-local-dbfs-connection" title="Permanent link">&para;</a></h3>
<p>For Databricks DBFS paths:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span><span class="nt">dbfs</span><span class="p">:</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_dbfs</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="nt">base_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dbfs/mnt/datalake</span>
</code></pre></div>
<p>Supports: <code>dbfs:/</code>, <code>/dbfs/</code>, and mounted paths.</p>
<hr />
<h3 id="66-variable-substitution">6.6 Variable Substitution<a class="headerlink" href="#66-variable-substitution" title="Permanent link">&para;</a></h3>
<p>Odibi YAML supports powerful variable substitution for secrets, reusable values, and dynamic dates.</p>
<h4 id="environment-variables-var">Environment Variables: <code>${VAR}</code><a class="headerlink" href="#environment-variables-var" title="Permanent link">&para;</a></h4>
<p>Inject values from environment variables (recommended for secrets):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="nt">database</span><span class="p">:</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlserver</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span><span class="w">    </span><span class="c1"># From environment</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${env:DB_HOST}</span><span class="w">        </span><span class="c1"># Explicit env: prefix (same behavior)</span>
</code></pre></div>
<h4 id="custom-variables-varsname">Custom Variables: <code>${vars.name}</code><a class="headerlink" href="#custom-variables-varsname" title="Permanent link">&para;</a></h4>
<p>Define reusable values in a <code>vars:</code> block:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nt">vars</span><span class="p">:</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="nt">retention_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">  </span><span class="nt">storage</span><span class="p">:</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">    </span><span class="nt">container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-${vars.env}</span><span class="w">    </span><span class="c1"># → data-production</span>
</code></pre></div>
<h4 id="date-variables-dateexpression">Date Variables: <code>${date:expression}</code><a class="headerlink" href="#date-variables-dateexpression" title="Permanent link">&para;</a></h4>
<p>Generate dynamic dates at config load time (works <strong>anywhere in YAML</strong>):</p>
<table>
<thead>
<tr>
<th>Expression</th>
<th>Description</th>
<th>Example Output</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>${date:today}</code></td>
<td>Today's date</td>
<td><code>2024-01-15</code></td>
</tr>
<tr>
<td><code>${date:yesterday}</code></td>
<td>Yesterday</td>
<td><code>2024-01-14</code></td>
</tr>
<tr>
<td><code>${date:now}</code></td>
<td>Current datetime</td>
<td><code>2024-01-15 14:30:45</code></td>
</tr>
<tr>
<td><code>${date:-7d}</code></td>
<td>7 days ago</td>
<td><code>2024-01-08</code></td>
</tr>
<tr>
<td><code>${date:-1m}</code></td>
<td>~1 month ago</td>
<td><code>2023-12-15</code></td>
</tr>
<tr>
<td><code>${date:start_of_month}</code></td>
<td>First of month</td>
<td><code>2024-01-01</code></td>
</tr>
<tr>
<td><code>${date:today:%Y%m%d}</code></td>
<td>Custom format</td>
<td><code>20240115</code></td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nt">pipelines</span><span class="p">:</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">daily_export</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Data</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">${date:-7d}</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">${date:today}&quot;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">export</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">        </span><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exports/${date:today:%Y/%m/%d}/data.parquet</span>
</code></pre></div></p>
<p><strong>Injecting custom dates via environment:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">REPORT_DATE</span><span class="o">=</span><span class="m">2024</span>-01-01
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">  </span><span class="nt">date</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${REPORT_DATE}</span><span class="w">    </span><span class="c1"># Uses injected value, NOT dynamic</span>
</code></pre></div></p>
<p>📖 <strong>Full documentation:</strong> <a href="../guides/variable_substitution/">Variable Substitution Guide</a></p>
<hr />
<h3 id="67-api-fetching-rest-apis">6.7 API Fetching (REST APIs)<a class="headerlink" href="#67-api-fetching-rest-apis" title="Permanent link">&para;</a></h3>
<p>Read data from REST APIs with pagination, retries, and rate limiting.</p>
<h4 id="basic-get-api">Basic GET API<a class="headerlink" href="#basic-get-api" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="nt">read</span><span class="p">:</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_api</span><span class="w">      </span><span class="c1"># HTTP connection</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/v1/records</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">    </span><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">      </span><span class="nt">limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">    </span><span class="nt">pagination</span><span class="p">:</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">offset_limit</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">      </span><span class="nt">offset_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">skip</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">      </span><span class="nt">limit_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">limit</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">      </span><span class="nt">limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">      </span><span class="nt">max_pages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">    </span><span class="nt">response</span><span class="p">:</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">      </span><span class="nt">items_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">results</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w">      </span><span class="nt">add_fields</span><span class="p">:</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">        </span><span class="nt">_fetched_at</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${date:now}&quot;</span>
</code></pre></div>
<h4 id="post-api-complex-queries">POST API (Complex Queries)<a class="headerlink" href="#post-api-complex-queries" title="Permanent link">&para;</a></h4>
<p>Some APIs use POST with JSON body for complex filters:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nt">read</span><span class="p">:</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fda_dashboard</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/v1/recalls</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POST</span><span class="w">              </span><span class="c1"># Use POST instead of GET</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">    </span><span class="nt">request_body</span><span class="p">:</span><span class="w">             </span><span class="c1"># JSON body</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">      </span><span class="nt">filters</span><span class="p">:</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">        </span><span class="nt">Classification</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;Class</span><span class="nv"> </span><span class="s">I&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w">        </span><span class="nt">PostedDateFrom</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;${date:-30d}&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">      </span><span class="nt">columns</span><span class="p">:</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RecallID</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FirmName</span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">    </span><span class="nt">pagination</span><span class="p">:</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">offset_limit</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">      </span><span class="nt">offset_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start</span><span class="w">     </span><span class="c1"># Goes into JSON body for POST</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="w">      </span><span class="nt">limit_param</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rows</span>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="w">      </span><span class="nt">limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="w">      </span><span class="nt">start_offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">         </span><span class="c1"># For 1-indexed APIs</span>
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="w">    </span><span class="nt">response</span><span class="p">:</span>
<a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="w">      </span><span class="nt">items_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>method</code></td>
<td>HTTP method: GET (default), POST, PUT, PATCH, DELETE</td>
</tr>
<tr>
<td><code>params</code></td>
<td>URL query params (GET) or merged into body (POST)</td>
</tr>
<tr>
<td><code>request_body</code></td>
<td>JSON body for POST/PUT/PATCH</td>
</tr>
<tr>
<td><code>pagination.start_offset</code></td>
<td>Starting offset (0 or 1 for 1-indexed APIs)</td>
</tr>
</tbody>
</table>
<p>📖 <strong>Full documentation:</strong> <a href="../guides/api_data_sources/">API Data Sources Guide</a></p>
<hr />
<h2 id="7-write-configuration-delta-lake-features">7. Write Configuration (Delta Lake Features)<a class="headerlink" href="#7-write-configuration-delta-lake-features" title="Permanent link">&para;</a></h2>
<h3 id="71-partitioning-z-ordering">7.1 Partitioning &amp; Z-Ordering<a class="headerlink" href="#71-partitioning-z-ordering" title="Permanent link">&para;</a></h3>
<p>For large tables, use partitioning and Z-ordering to optimize query performance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gold_lake</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">  </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact_sales</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">append</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">  </span><span class="c1"># Partitioning: Physical folders (low-cardinality columns)</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">  </span><span class="nt">partition_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">country_code</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">txn_year_month</span><span class="p p-Indicator">]</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">  </span><span class="c1"># Z-Ordering: Data clustering (high-cardinality columns)</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">  </span><span class="nt">zorder_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">product_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">  </span><span class="c1"># Delta table properties</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">  </span><span class="nt">table_properties</span><span class="p">:</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="s">&quot;delta.autoOptimize.optimizeWrite&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">    </span><span class="s">&quot;delta.autoOptimize.autoCompact&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Feature</th>
<th>When to Use</th>
<th>Cardinality</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>partition_by</code></td>
<td>Columns in WHERE clauses</td>
<td>Low (country, year_month)</td>
</tr>
<tr>
<td><code>zorder_by</code></td>
<td>Columns in JOINs/filters</td>
<td>High (customer_id, product_id)</td>
</tr>
</tbody>
</table>
<h3 id="72-schema-evolution">7.2 Schema Evolution<a class="headerlink" href="#72-schema-evolution" title="Permanent link">&para;</a></h3>
<p>Allow adding new columns without breaking existing pipelines:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overwrite</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">  </span><span class="nt">merge_schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Enable schema evolution</span>
</code></pre></div>
<h3 id="73-auto-optimize-vacuum-optimize">7.3 Auto-Optimize (VACUUM &amp; OPTIMIZE)<a class="headerlink" href="#73-auto-optimize-vacuum-optimize" title="Permanent link">&para;</a></h3>
<p>Automatically run Delta Lake maintenance after writes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">  </span><span class="nt">auto_optimize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Use defaults (168 hours retention)</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="c1"># OR with custom config:</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">  </span><span class="nt">auto_optimize</span><span class="p">:</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="nt">vacuum_retention_hours</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">168</span><span class="w">  </span><span class="c1"># 7 days (set to 0 to disable VACUUM)</span>
</code></pre></div>
<h3 id="74-bronze-metadata-columns">7.4 Bronze Metadata Columns<a class="headerlink" href="#74-bronze-metadata-columns" title="Permanent link">&para;</a></h3>
<p>Add lineage tracking columns during ingestion:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bronze</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">  </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">append</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">  </span><span class="nt">add_metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Adds all applicable columns</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="c1"># OR selective:</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bronze</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">  </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">append</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">  </span><span class="nt">add_metadata</span><span class="p">:</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">    </span><span class="nt">extracted_at</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">        </span><span class="c1"># _extracted_at: pipeline timestamp</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">    </span><span class="nt">source_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">         </span><span class="c1"># _source_file: filename (file sources)</span>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">    </span><span class="nt">source_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># _source_connection: connection name</span>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">    </span><span class="nt">source_table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">       </span><span class="c1"># _source_table: table name (SQL sources)</span>
</code></pre></div>
<h3 id="75-skip-if-unchanged">7.5 Skip If Unchanged<a class="headerlink" href="#75-skip-if-unchanged" title="Permanent link">&para;</a></h3>
<p>Avoid redundant writes for snapshot tables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reference_data</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overwrite</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">  </span><span class="nt">skip_if_unchanged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">           </span><span class="c1"># Compares SHA256 hash of content</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">  </span><span class="nt">skip_hash_columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">id</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">name</span><span class="p p-Indicator">]</span><span class="w">     </span><span class="c1"># Only hash these columns</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">  </span><span class="nt">skip_hash_sort_columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">id</span><span class="p p-Indicator">]</span><span class="w">      </span><span class="c1"># Sort before hashing for determinism</span>
</code></pre></div>
<h3 id="76-time-travel-read">7.6 Time Travel (Read)<a class="headerlink" href="#76-time-travel-read" title="Permanent link">&para;</a></h3>
<p>Read historical versions of Delta tables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nt">read</span><span class="p">:</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">  </span><span class="nt">time_travel</span><span class="p">:</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="w">    </span><span class="nt">as_of_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">    </span><span class="c1"># OR</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">    </span><span class="nt">as_of_timestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2023-10-01T12:00:00Z&quot;</span>
</code></pre></div>
<h3 id="77-streaming-writes-spark-structured-streaming">7.7 Streaming Writes (Spark Structured Streaming)<a class="headerlink" href="#77-streaming-writes-spark-structured-streaming" title="Permanent link">&para;</a></h3>
<p>Process data continuously with fault tolerance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver_lake</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">  </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">events_stream</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">  </span><span class="nt">streaming</span><span class="p">:</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">    </span><span class="nt">output_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">append</span><span class="w">          </span><span class="c1"># append, update, complete</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w">    </span><span class="nt">checkpoint_location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/checkpoints/events_stream</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">    </span><span class="nt">trigger</span><span class="p">:</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">      </span><span class="nt">processing_time</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10</span><span class="nv"> </span><span class="s">seconds&quot;</span><span class="w">  </span><span class="c1"># Micro-batch interval</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">      </span><span class="c1"># OR: available_now: true      # Process all, then stop</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">    </span><span class="nt">query_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">events_ingestion</span><span class="w">     </span><span class="c1"># For monitoring</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="w">    </span><span class="nt">await_termination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<hr />
<h2 id="8-alerts-notifications">8. Alerts &amp; Notifications<a class="headerlink" href="#8-alerts-notifications" title="Permanent link">&para;</a></h2>
<h3 id="81-alert-configuration">8.1 Alert Configuration<a class="headerlink" href="#81-alert-configuration" title="Permanent link">&para;</a></h3>
<p>Send notifications to Slack, Teams, or webhooks on pipeline events:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nt">alerts</span><span class="p">:</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slack</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SLACK_WEBHOOK_URL}&quot;</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="nt">on_events</span><span class="p">:</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on_failure</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on_quarantine</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on_gate_block</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">      </span><span class="nt">throttle_minutes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w">  </span><span class="c1"># Don&#39;t spam</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">      </span><span class="nt">max_per_hour</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">      </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#data-alerts&quot;</span>
</code></pre></div>
<h3 id="82-available-events">8.2 Available Events<a class="headerlink" href="#82-available-events" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Event</th>
<th>Trigger</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>on_start</code></td>
<td>Pipeline started</td>
</tr>
<tr>
<td><code>on_success</code></td>
<td>Pipeline completed successfully</td>
</tr>
<tr>
<td><code>on_failure</code></td>
<td>Pipeline failed</td>
</tr>
<tr>
<td><code>on_quarantine</code></td>
<td>Rows were quarantined</td>
</tr>
<tr>
<td><code>on_gate_block</code></td>
<td>Quality gate blocked pipeline</td>
</tr>
<tr>
<td><code>on_threshold_breach</code></td>
<td>A threshold was exceeded</td>
</tr>
</tbody>
</table>
<h3 id="83-alert-types">8.3 Alert Types<a class="headerlink" href="#83-alert-types" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slack</code></td>
<td>Slack webhook</td>
</tr>
<tr>
<td><code>teams</code></td>
<td>Microsoft Teams webhook</td>
</tr>
<tr>
<td><code>webhook</code></td>
<td>Generic HTTP POST</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9-system-catalog-the-brain">9. System Catalog (The Brain)<a class="headerlink" href="#9-system-catalog-the-brain" title="Permanent link">&para;</a></h2>
<p>The System Catalog stores metadata about pipelines, runs, schemas, and lineage in Delta tables.</p>
<h3 id="91-configuration">9.1 Configuration<a class="headerlink" href="#91-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="nt">system</span><span class="p">:</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">adls_bronze</span><span class="w">        </span><span class="c1"># Must be blob storage (supports Delta)</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_odibi_system</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span><span class="w">               </span><span class="c1"># Tag for multi-environment queries</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">  </span><span class="c1"># Optional: Sync to SQL Server for dashboards</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">  </span><span class="nt">sync_to</span><span class="p">:</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">    </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql_server_prod</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">    </span><span class="nt">schema_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">odibi_system</span>
</code></pre></div>
<h3 id="92-meta-tables">9.2 Meta Tables<a class="headerlink" href="#92-meta-tables" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>meta_tables</code></td>
<td>Table schemas and column info</td>
</tr>
<tr>
<td><code>meta_runs</code></td>
<td>Pipeline execution history</td>
</tr>
<tr>
<td><code>meta_patterns</code></td>
<td>Pattern configurations used</td>
</tr>
<tr>
<td><code>meta_metrics</code></td>
<td>Metric definitions and values</td>
</tr>
<tr>
<td><code>meta_state</code></td>
<td>High Water Mark and incremental state</td>
</tr>
<tr>
<td><code>meta_pipelines</code></td>
<td>Pipeline definitions</td>
</tr>
<tr>
<td><code>meta_nodes</code></td>
<td>Node configurations</td>
</tr>
<tr>
<td><code>meta_schemas</code></td>
<td>Schema versions</td>
</tr>
<tr>
<td><code>meta_lineage</code></td>
<td>Data lineage relationships</td>
</tr>
<tr>
<td><code>meta_outputs</code></td>
<td>Output table metadata</td>
</tr>
<tr>
<td><code>meta_pipeline_runs</code></td>
<td>Summary of pipeline runs</td>
</tr>
<tr>
<td><code>meta_node_runs</code></td>
<td>Summary of node runs</td>
</tr>
<tr>
<td><code>meta_failures</code></td>
<td>Failed runs with error details</td>
</tr>
<tr>
<td><code>meta_daily_stats</code></td>
<td>Daily execution statistics</td>
</tr>
<tr>
<td><code>meta_pipeline_health</code></td>
<td>Pipeline health scores</td>
</tr>
<tr>
<td><code>meta_sla_status</code></td>
<td>SLA compliance tracking</td>
</tr>
</tbody>
</table>
<h3 id="93-cost-tracking">9.3 Cost Tracking<a class="headerlink" href="#93-cost-tracking" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="nt">system</span><span class="p">:</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">adls_prod</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">  </span><span class="nt">cost_per_compute_hour</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.15</span><span class="w">    </span><span class="c1"># Estimated $/hour</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">  </span><span class="nt">databricks_billing_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Query actual DBR costs</span>
</code></pre></div>
<hr />
<h2 id="10-openlineage-integration">10. OpenLineage Integration<a class="headerlink" href="#10-openlineage-integration" title="Permanent link">&para;</a></h2>
<p>Track data lineage to external systems (Marquez, Atlan, DataHub):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nt">lineage</span><span class="p">:</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://localhost:5000&quot;</span><span class="w">    </span><span class="c1"># OpenLineage API endpoint</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;my_project&quot;</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">  </span><span class="nt">api_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${OPENLINEAGE_API_KEY}&quot;</span>
</code></pre></div>
<p><strong>Events emitted:</strong>
- Pipeline start/complete/fail
- Node inputs/outputs with schemas
- Parent-child run relationships</p>
<hr />
<h2 id="11-foreign-key-validation">11. Foreign Key Validation<a class="headerlink" href="#11-foreign-key-validation" title="Permanent link">&para;</a></h2>
<p>Validate referential integrity between fact and dimension tables:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="nt">relationships</span><span class="p">:</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders_to_customers</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">    </span><span class="nt">fact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact_orders</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">    </span><span class="nt">dimension</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customer</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">    </span><span class="nt">fact_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_sk</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">    </span><span class="nt">dimension_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_sk</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">    </span><span class="nt">nullable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">    </span><span class="nt">on_violation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">error</span><span class="w">  </span><span class="c1"># warn, error, quarantine</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders_to_products</span>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="w">    </span><span class="nt">fact</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact_orders</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="w">    </span><span class="nt">dimension</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_product</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="w">    </span><span class="nt">fact_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">product_sk</span>
<a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="w">    </span><span class="nt">dimension_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">product_sk</span>
</code></pre></div>
<p><strong>Behavior:</strong>
- Validates FK columns exist in dimension tables
- Detects orphan records (FK not in dimension)
- Integrates with FactPattern automatically</p>
<hr />
<h2 id="12-orchestration-export">12. Orchestration Export<a class="headerlink" href="#12-orchestration-export" title="Permanent link">&para;</a></h2>
<p>Generate Airflow or Dagster DAGs from odibi pipelines:</p>
<h3 id="121-airflow-export">12.1 Airflow Export<a class="headerlink" href="#121-airflow-export" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>odibi<span class="w"> </span><span class="nb">export</span><span class="w"> </span>airflow<span class="w"> </span>--pipeline<span class="w"> </span>my_pipeline<span class="w"> </span>--output<span class="w"> </span>dags/
</code></pre></div>
<p>Generates a Python DAG file with:
- BashOperator tasks for each node
- Task dependencies from <code>depends_on</code>
- Retry configuration</p>
<h3 id="122-dagster-export">12.2 Dagster Export<a class="headerlink" href="#122-dagster-export" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>odibi<span class="w"> </span><span class="nb">export</span><span class="w"> </span>dagster<span class="w"> </span>--pipeline<span class="w"> </span>my_pipeline<span class="w"> </span>--output<span class="w"> </span>ops/
</code></pre></div>
<hr />
<h2 id="13-manufacturing-transformers">13. Manufacturing Transformers<a class="headerlink" href="#13-manufacturing-transformers" title="Permanent link">&para;</a></h2>
<p>Specialized transformers for process/batch manufacturing data:</p>
<h3 id="131-detect-sequential-phases">13.1 Detect Sequential Phases<a class="headerlink" href="#131-detect-sequential-phases" title="Permanent link">&para;</a></h3>
<p>Analyze batch process phases from PLC timer columns:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">detect_sequential_phases</span><span class="p">:</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">      </span><span class="nt">group_by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BatchID</span><span class="w">           </span><span class="c1"># Or [BatchID, AssetID]</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">      </span><span class="nt">timestamp_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ts</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">      </span><span class="nt">phases</span><span class="p">:</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timer_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadTime</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timer_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CookTime</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timer_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CoolTime</span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">timer_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UnloadTime</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">      </span><span class="nt">start_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">240</span><span class="w">        </span><span class="c1"># Max seconds to consider valid start</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="w">      </span><span class="nt">status_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Status</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="w">      </span><span class="nt">status_mapping</span><span class="p">:</span>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="w">        </span><span class="nt">1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">idle</span>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="w">        </span><span class="nt">2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="w">        </span><span class="nt">3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hold</span>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="w">        </span><span class="nt">4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">faulted</span>
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">      </span><span class="nt">phase_metrics</span><span class="p">:</span>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">        </span><span class="nt">Level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">max</span><span class="w">               </span><span class="c1"># Aggregate column during phase</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="w">      </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="w">        </span><span class="nt">ProductCode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">first_after_start</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a><span class="w">        </span><span class="nt">Weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">max</span>
</code></pre></div>
<p><strong>Use cases:</strong>
- Batch reactor cycle analysis
- CIP (Clean-in-Place) phase timing
- Food processing cycle tracking
- Any multi-step batch process with PLC timers</p>
<p><strong>Output columns:</strong>
- <code>phase_name</code>, <code>phase_start</code>, <code>phase_end</code>, <code>phase_duration_seconds</code>
- Status time breakdown: <code>time_in_idle</code>, <code>time_in_active</code>, etc.
- Aggregated metrics per phase</p>
<hr />
<h2 id="14-semantic-layer">14. Semantic Layer<a class="headerlink" href="#14-semantic-layer" title="Permanent link">&para;</a></h2>
<p>The semantic layer provides a metrics abstraction for BI consumption.</p>
<h3 id="141-metric-definitions">14.1 Metric Definitions<a class="headerlink" href="#141-metric-definitions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># metrics.yaml</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="nt">metrics</span><span class="p">:</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total_revenue</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Total order revenue</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SUM(total_amount)&quot;</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$build_warehouse.fact_orders</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_count</span>
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Number of orders</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;COUNT(*)&quot;</span>
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$build_warehouse.fact_orders</span>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">avg_order_value</span>
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Average order value</span>
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">derived</span>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">    </span><span class="nt">components</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">total_revenue</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">order_count</span><span class="p p-Indicator">]</span>
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="w">    </span><span class="nt">formula</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;total_revenue</span><span class="nv"> </span><span class="s">/</span><span class="nv"> </span><span class="s">order_count&quot;</span>
</code></pre></div>
<h3 id="142-dimension-definitions">14.2 Dimension Definitions<a class="headerlink" href="#142-dimension-definitions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="nt">dimensions</span><span class="p">:</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_date</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$build_warehouse.fact_orders</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w">    </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order_date</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">    </span><span class="nt">grain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">month</span><span class="w">  </span><span class="c1"># day, week, month, quarter, year</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_region</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$build_warehouse.dim_customer</span>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">    </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">region</span>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">    </span><span class="nt">hierarchy</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">country</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">region</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">city</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Drill-down path</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fiscal_year</span>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$build_warehouse.dim_date</span>
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;YEAR(DATEADD(month,</span><span class="nv"> </span><span class="s">6,</span><span class="nv"> </span><span class="s">date_key))&quot;</span><span class="w">  </span><span class="c1"># Custom expression</span>
</code></pre></div>
<h3 id="143-semantic-queries">14.3 Semantic Queries<a class="headerlink" href="#143-semantic-queries" title="Permanent link">&para;</a></h3>
<p>Query metrics using natural syntax:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.semantics</span><span class="w"> </span><span class="kn">import</span> <span class="n">SemanticQuery</span><span class="p">,</span> <span class="n">parse_semantic_config</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">parse_semantic_config</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;metrics.yaml&quot;</span><span class="p">)))</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="n">query</span> <span class="o">=</span> <span class="n">SemanticQuery</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="c1"># Execute query</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>    <span class="s2">&quot;total_revenue, order_count BY customer_region, order_date WHERE status = &#39;completed&#39;&quot;</span><span class="p">,</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>    <span class="n">context</span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="p">)</span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># DataFrame with aggregated metrics</span>
</code></pre></div>
<p><strong>Query Syntax:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>metric1, metric2 BY dimension1, dimension2 WHERE condition
</code></pre></div></p>
<h3 id="144-materialization">14.4 Materialization<a class="headerlink" href="#144-materialization" title="Permanent link">&para;</a></h3>
<p>Pre-compute metrics for performance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nt">materializations</span><span class="p">:</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">daily_sales_by_region</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">    </span><span class="nt">metrics</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">total_revenue</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">order_count</span><span class="p p-Indicator">]</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">    </span><span class="nt">dimensions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">order_date</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">customer_region</span><span class="p p-Indicator">]</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gold.daily_sales_by_region</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">5</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span><span class="w">  </span><span class="c1"># Daily at 5am</span>
</code></pre></div>
<h3 id="145-sql-server-views">14.5 SQL Server Views<a class="headerlink" href="#145-sql-server-views" title="Permanent link">&para;</a></h3>
<p>Generate views for analyst consumption:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="nt">views</span><span class="p">:</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vw_daily_sales</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Daily sales metrics</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">    </span><span class="nt">metrics</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">total_revenue</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">order_count</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">avg_order_value</span><span class="p p-Indicator">]</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">    </span><span class="nt">dimensions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">order_date</span><span class="p p-Indicator">]</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">    </span><span class="nt">db_schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semantic</span>
</code></pre></div>
<hr />
<h2 id="15-story-generation">15. Story Generation<a class="headerlink" href="#15-story-generation" title="Permanent link">&para;</a></h2>
<p>Stories are execution reports generated after each pipeline run.</p>
<h3 id="151-configuration">15.1 Configuration<a class="headerlink" href="#151-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="nt">story</span><span class="p">:</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">  </span><span class="nt">output_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stories/</span><span class="w">  </span><span class="c1"># Local or abfss:// path</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">  </span><span class="nt">max_sample_rows</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">  </span><span class="nt">retention_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">  </span><span class="nt">retention_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</code></pre></div>
<h3 id="152-story-contents">15.2 Story Contents<a class="headerlink" href="#152-story-contents" title="Permanent link">&para;</a></h3>
<p>Each story includes:
- <strong>Pipeline metadata</strong>: Name, start/end time, duration
- <strong>Node details</strong>: Status, row counts, duration, schema
- <strong>Validation results</strong>: Tests passed/failed
- <strong>Data samples</strong>: First N rows of output
- <strong>Lineage</strong>: Input/output relationships
- <strong>DAG visualization</strong>: Interactive dependency graph</p>
<h3 id="153-viewing-stories">15.3 Viewing Stories<a class="headerlink" href="#153-viewing-stories" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1"># View last story</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>odibi<span class="w"> </span>story<span class="w"> </span>last
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="c1"># View specific story</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>odibi<span class="w"> </span>story<span class="w"> </span>show<span class="w"> </span>stories/my_pipeline_2024-01-15_10-30-00.html
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="c1"># View specific node</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>odibi<span class="w"> </span>story<span class="w"> </span>last<span class="w"> </span>--node<span class="w"> </span>dim_customers
</code></pre></div>
<h3 id="154-story-metadata">15.4 Story Metadata<a class="headerlink" href="#154-story-metadata" title="Permanent link">&para;</a></h3>
<p>Available in <code>PipelineResults.story_path</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;my_pipeline&quot;</span><span class="p">)</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Story: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">story_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="155-documentation-generation">15.5 Documentation Generation<a class="headerlink" href="#155-documentation-generation" title="Permanent link">&para;</a></h3>
<p>Generate structured markdown documentation from Story artifacts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nt">story</span><span class="p">:</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local_data</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stories/</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="w">  </span><span class="nt">docs</span><span class="p">:</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="w">    </span><span class="nt">output_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docs/generated/</span><span class="w">   </span><span class="c1"># Project-level docs location</span>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="w">      </span><span class="nt">readme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">              </span><span class="c1"># README.md - stakeholder-facing</span>
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="w">      </span><span class="nt">technical_details</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">   </span><span class="c1"># TECHNICAL_DETAILS.md - engineer-facing</span>
<a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="w">      </span><span class="nt">node_cards</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">          </span><span class="c1"># NODE_CARDS/*.md - per-node details</span>
<a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="w">      </span><span class="nt">run_memo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">            </span><span class="c1"># Per-run summary (always generated)</span>
<a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>
<a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="w">    </span><span class="nt">include</span><span class="p">:</span>
<a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="w">      </span><span class="nt">sql</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">                 </span><span class="c1"># Include executed SQL in node cards</span>
<a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="w">      </span><span class="nt">config_snapshot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># Include YAML config snapshots</span>
<a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="w">      </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">              </span><span class="c1"># Include schema tables</span>
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> When using remote storage (ADLS, S3, etc.), documentation files are written to the same storage location as stories. The <code>output_path</code> is relative to the story connection's base path. Use Azure Storage Explorer, AWS Console, or the appropriate tool to browse generated docs.</p>
</blockquote>
<p><strong>Generated Artifacts:</strong></p>
<table>
<thead>
<tr>
<th>Artifact</th>
<th>Scope</th>
<th>Update Policy</th>
</tr>
</thead>
<tbody>
<tr>
<td>README.md</td>
<td>Project</td>
<td>On successful runs only</td>
</tr>
<tr>
<td>TECHNICAL_DETAILS.md</td>
<td>Project</td>
<td>On successful runs only</td>
</tr>
<tr>
<td>NODE_CARDS/*.md</td>
<td>Project</td>
<td>On successful runs only</td>
</tr>
<tr>
<td>run_*_memo.md</td>
<td>Per-run</td>
<td>Every run (including failures)</td>
</tr>
</tbody>
</table>
<p><strong>File Structure:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>project/
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>├── docs/
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>│   └── generated/
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>│       ├── README.md              # Pipeline overview
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>│       ├── TECHNICAL_DETAILS.md   # Full execution details
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>│       └── node_cards/
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>│           ├── load_customers.md  # Per-node documentation
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>│           └── dim_customer.md
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>└── stories/
<a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>    └── my_pipeline/
<a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>        └── 2026-01-21/
<a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>            ├── run_14-30-00.html   # Interactive story
<a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a>            ├── run_14-30-00.json   # Machine-readable
<a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a>            └── run_14-30-00_memo.md  # Run summary
</code></pre></div></p>
<p><strong>README.md includes:</strong>
- Pipeline name and layer badge
- Last run status and metrics
- Project context (project, plant, asset)
- Node summary table with links to NODE_CARDS
- Links to TECHNICAL_DETAILS and Story HTML</p>
<p><strong>NODE_CARDS include:</strong>
- Node description (from config)
- Operation type and duration
- Schema in/out with changes highlighted
- Executed SQL (syntax highlighted)
- Transformation stack
- Validation warnings
- Config snapshot (YAML)</p>
<p><strong>RUN_MEMO includes:</strong>
- Run status and timestamp
- What changed from last successful run
- Anomalies detected
- Failed node details with error messages
- Data quality issues</p>
<hr />
<h2 id="16-common-workflows">16. Common Workflows<a class="headerlink" href="#16-common-workflows" title="Permanent link">&para;</a></h2>
<h3 id="161-run-a-pipeline-and-query-intermediate-results-spark">16.1 Run a Pipeline and Query Intermediate Results (Spark)<a class="headerlink" href="#161-run-a-pipeline-and-query-intermediate-results-spark" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi</span><span class="w"> </span><span class="kn">import</span> <span class="n">PipelineManager</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="c1"># Initialize</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="n">pm</span> <span class="o">=</span> <span class="n">PipelineManager</span><span class="p">(</span><span class="s2">&quot;project.yaml&quot;</span><span class="p">)</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="c1"># Run pipeline</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="n">results</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;silver_pipeline&quot;</span><span class="p">)</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="c1"># Query any node&#39;s output via Spark SQL</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">spark</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="n">customers_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM dim_customers WHERE tier = &#39;Gold&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="n">customers_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="c1"># Or via context</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dim_customers&quot;</span><span class="p">)</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="c1"># List all available nodes</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">list_names</span><span class="p">())</span>
</code></pre></div>
<h3 id="162-debug-a-failing-node">16.2 Debug a Failing Node<a class="headerlink" href="#162-debug-a-failing-node" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1"># 1. Run with verbose logging</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--log-level<span class="w"> </span>DEBUG
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="c1"># 2. View the execution story</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>odibi<span class="w"> </span>story<span class="w"> </span>last
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="c1"># 3. Inspect specific node</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>odibi<span class="w"> </span>story<span class="w"> </span>last<span class="w"> </span>--node<span class="w"> </span>failing_node_name
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="c1"># 4. Run single node in isolation</span>
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--node<span class="w"> </span>failing_node_name<span class="w"> </span>--dry-run
</code></pre></div>
<p><strong>In Python:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="n">pm</span> <span class="o">=</span> <span class="n">PipelineManager</span><span class="p">(</span><span class="s2">&quot;project.yaml&quot;</span><span class="p">)</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="n">result</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;pipeline&quot;</span><span class="p">)</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="c1"># Get specific node result</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="n">node_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_node_result</span><span class="p">(</span><span class="s2">&quot;failing_node&quot;</span><span class="p">)</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">node_result</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>  <span class="c1"># Full error message</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="nb">print</span><span class="p">(</span><span class="n">node_result</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input_schema&quot;</span><span class="p">))</span>  <span class="c1"># Schema at input</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="nb">print</span><span class="p">(</span><span class="n">node_result</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rows_read&quot;</span><span class="p">))</span>  <span class="c1"># Row count at input</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="c1"># Debug summary with next steps</span>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">debug_summary</span><span class="p">())</span>
</code></pre></div></p>
<h3 id="163-add-a-new-scd2-dimension">16.3 Add a New SCD2 Dimension<a class="headerlink" href="#163-add-a-new-scd2-dimension" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Create bronze node (raw data)</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bronze_customers</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">    </span><span class="nt">read</span><span class="p">:</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">      </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source_db</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="w">      </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers</span>
</code></pre></div></p>
<p><strong>Step 2: Create silver node (SCD2)</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customers</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">bronze_customers</span><span class="p p-Indicator">]</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="w">      </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bronze_customers</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">    </span><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">scd2</span><span class="p">:</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">          </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">adls_prod</span>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">silver/dim_customers</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">          </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">          </span><span class="nt">track_cols</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">name</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">email</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">address</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">tier</span><span class="p p-Indicator">]</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">          </span><span class="nt">effective_time_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
</code></pre></div>
SCD2 is self-contained — it writes directly to the target table. No <code>write:</code> block is needed.</p>
<p><strong>Step 3: Verify</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="s2">  SELECT customer_id, name, valid_to, is_current</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="s2">  FROM dim_customers</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="s2">  WHERE customer_id = 123</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="s2">  ORDER BY valid_to</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></p>
<h3 id="164-create-a-custom-transformer">16.4 Create a Custom Transformer<a class="headerlink" href="#164-create-a-custom-transformer" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Create the function</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="c1"># my_transformers.py</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">EngineContext</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyTransformParams</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>    <span class="n">input_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Column to transform&quot;</span><span class="p">)</span>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>    <span class="n">output_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Output column name&quot;</span><span class="p">)</span>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">my_custom_transform</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">EngineContext</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">MyTransformParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EngineContext</span><span class="p">:</span>
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>    <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT *, UPPER(</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">input_col</span><span class="si">}</span><span class="s2">) AS </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">output_col</span><span class="si">}</span><span class="s2"> FROM df&quot;</span>
<a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Step 2: Register it</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.registry</span><span class="w"> </span><span class="kn">import</span> <span class="n">FunctionRegistry</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">my_transformers</span><span class="w"> </span><span class="kn">import</span> <span class="n">my_custom_transform</span><span class="p">,</span> <span class="n">MyTransformParams</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="n">FunctionRegistry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">my_custom_transform</span><span class="p">,</span> <span class="s2">&quot;my_custom_transform&quot;</span><span class="p">,</span> <span class="n">MyTransformParams</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Step 3: Use in YAML</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">my_custom_transform</span><span class="p">:</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="w">      </span><span class="nt">input_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">      </span><span class="nt">output_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name_upper</span>
</code></pre></div></p>
<h3 id="165-run-in-databricks">16.5 Run in Databricks<a class="headerlink" href="#165-run-in-databricks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># Databricks notebook cell</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="c1"># Install odibi</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">odibi</span><span class="p">[</span><span class="n">azure</span><span class="p">]</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="c1"># Get SparkSession</span>
<a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">SparkSession</span>
<a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a>
<a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="c1"># Configure pipeline with Spark engine</span>
<a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi</span><span class="w"> </span><span class="kn">import</span> <span class="n">PipelineManager</span>
<a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a>
<a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="n">pm</span> <span class="o">=</span> <span class="n">PipelineManager</span><span class="p">(</span>
<a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a>    <span class="s2">&quot;project.yaml&quot;</span><span class="p">,</span>
<a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a>    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;spark&quot;</span><span class="p">,</span>
<a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a>    <span class="n">spark_session</span><span class="o">=</span><span class="n">spark</span>
<a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="p">)</span>
<a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a>
<a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="c1"># Run</span>
<a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="n">results</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;my_pipeline&quot;</span><span class="p">)</span>
<a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a>
<a id="__codelineno-83-22" name="__codelineno-83-22" href="#__codelineno-83-22"></a><span class="c1"># Query results as temp views</span>
<a id="__codelineno-83-23" name="__codelineno-83-23" href="#__codelineno-83-23"></a><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM node_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<a id="__codelineno-83-24" name="__codelineno-83-24" href="#__codelineno-83-24"></a>
<a id="__codelineno-83-25" name="__codelineno-83-25" href="#__codelineno-83-25"></a><span class="c1"># Or write to Unity Catalog</span>
<a id="__codelineno-83-26" name="__codelineno-83-26" href="#__codelineno-83-26"></a><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE catalog.schema.table AS SELECT * FROM node_name&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Key Differences from Local:</strong>
- Use <code>engine="spark"</code>
- Pass existing <code>spark_session</code>
- ADLS connections use <code>managed_identity</code> auth
- Node outputs are temp views queryable via <code>spark.sql()</code></p>
<h3 id="166-incremental-ingestion-with-high-water-mark">16.6 Incremental Ingestion with High Water Mark<a class="headerlink" href="#166-incremental-ingestion-with-high-water-mark" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bronze_orders</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">    </span><span class="nt">read</span><span class="p">:</span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">      </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source_db</span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">      </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">    </span><span class="nt">incremental</span><span class="p">:</span>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hwm</span><span class="w">              </span><span class="c1"># High Water Mark</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="w">      </span><span class="nt">state_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders_hwm</span><span class="w">  </span><span class="c1"># Persisted in state store</span>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="w">    </span><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="w">      </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bronze</span>
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders</span>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">append</span>
</code></pre></div>
<p><strong>First Run:</strong> Loads all data, stores max(updated_at) as HWM
<strong>Subsequent Runs:</strong> Filters <code>WHERE updated_at &gt; {hwm}</code>, appends new rows</p>
<hr />
<h2 id="17-cli-reference">17. CLI Reference<a class="headerlink" href="#17-cli-reference" title="Permanent link">&para;</a></h2>
<h3 id="171-core-commands">17.1 Core Commands<a class="headerlink" href="#171-core-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1"># Run a pipeline</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="c1"># Run specific nodes</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--node<span class="w"> </span>node_a<span class="w"> </span>--node<span class="w"> </span>node_b
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="c1"># Filter by tag</span>
<a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--tag<span class="w"> </span>silver
<a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a>
<a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="c1"># Dry run (validate without execution)</span>
<a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--dry-run
<a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a>
<a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a><span class="c1"># Resume from failure</span>
<a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--resume
<a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a>
<a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a><span class="c1"># Parallel execution</span>
<a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--parallel<span class="w"> </span>--workers<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a>
<a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a><span class="c1"># Error handling</span>
<a id="__codelineno-85-20" name="__codelineno-85-20" href="#__codelineno-85-20"></a>odibi<span class="w"> </span>run<span class="w"> </span>pipeline.yaml<span class="w"> </span>--on-error<span class="w"> </span>fail_later
</code></pre></div>
<h3 id="172-story-commands">17.2 Story Commands<a class="headerlink" href="#172-story-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>odibi<span class="w"> </span>story<span class="w"> </span>last<span class="w">                    </span><span class="c1"># View last execution</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>odibi<span class="w"> </span>story<span class="w"> </span>show<span class="w"> </span>path/to/story.html<span class="w"> </span><span class="c1"># View specific story</span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>odibi<span class="w"> </span>story<span class="w"> </span>last<span class="w"> </span>--node<span class="w"> </span>node_name<span class="w">   </span><span class="c1"># View specific node</span>
</code></pre></div>
<h3 id="173-validation-debug">17.3 Validation &amp; Debug<a class="headerlink" href="#173-validation-debug" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>odibi<span class="w"> </span>validate<span class="w"> </span>pipeline.yaml<span class="w">  </span><span class="c1"># Validate configuration</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>odibi<span class="w"> </span>graph<span class="w"> </span>pipeline.yaml<span class="w">     </span><span class="c1"># Show dependency graph</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>odibi<span class="w"> </span>graph<span class="w"> </span>pipeline.yaml<span class="w"> </span>--format<span class="w"> </span>ascii
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>odibi<span class="w"> </span>doctor<span class="w">                  </span><span class="c1"># Check environment</span>
</code></pre></div>
<h3 id="174-introspection-commands-ai-friendly">17.4 Introspection Commands (AI-Friendly)<a class="headerlink" href="#174-introspection-commands-ai-friendly" title="Permanent link">&para;</a></h3>
<p>These commands help AI tools discover available features programmatically:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># List all available transformers</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>odibi<span class="w"> </span>list<span class="w"> </span>transformers
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>odibi<span class="w"> </span>list<span class="w"> </span>transformers<span class="w"> </span>--format<span class="w"> </span>json<span class="w">   </span><span class="c1"># JSON output for parsing</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="c1"># List all available patterns</span>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>odibi<span class="w"> </span>list<span class="w"> </span>patterns
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>odibi<span class="w"> </span>list<span class="w"> </span>patterns<span class="w"> </span>--format<span class="w"> </span>json
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="c1"># List all connection types</span>
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>odibi<span class="w"> </span>list<span class="w"> </span>connections
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>odibi<span class="w"> </span>list<span class="w"> </span>connections<span class="w"> </span>--format<span class="w"> </span>json
<a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>
<a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="c1"># Get detailed documentation for any feature</span>
<a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>odibi<span class="w"> </span>explain<span class="w"> </span>fill_nulls<span class="w">      </span><span class="c1"># Explain a transformer</span>
<a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>odibi<span class="w"> </span>explain<span class="w"> </span>dimension<span class="w">       </span><span class="c1"># Explain a pattern</span>
<a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>odibi<span class="w"> </span>explain<span class="w"> </span>azure_sql<span class="w">       </span><span class="c1"># Explain a connection type</span>
</code></pre></div>
<p><strong>AI Workflow Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c1"># AI checks what&#39;s available before generating config</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>odibi<span class="w"> </span>list<span class="w"> </span>transformers<span class="w"> </span>--format<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.[] | .name&#39;</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="c1"># AI looks up specific transformer usage</span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>odibi<span class="w"> </span>explain<span class="w"> </span>derive_columns
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="c1"># AI validates generated config</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a>odibi<span class="w"> </span>validate<span class="w"> </span>generated_pipeline.yaml
</code></pre></div></p>
<h3 id="175-semantic-layer">17.5 Semantic Layer<a class="headerlink" href="#175-semantic-layer" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>odibi<span class="w"> </span>semantic<span class="w"> </span>run<span class="w"> </span>metrics.yaml<span class="w">     </span><span class="c1"># Execute semantic layer</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>odibi<span class="w"> </span>semantic<span class="w"> </span>materialize<span class="w"> </span>metrics.yaml
</code></pre></div>
<hr />
<h2 id="18-anti-patterns-and-gotchas">18. Anti-Patterns and Gotchas<a class="headerlink" href="#18-anti-patterns-and-gotchas" title="Permanent link">&para;</a></h2>
<h3 id="181-node-naming">18.1 Node Naming<a class="headerlink" href="#181-node-naming" title="Permanent link">&para;</a></h3>
<p>❌ <strong>Wrong:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim-customers</span><span class="w">      </span><span class="c1"># Hyphens break Spark SQL</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact sales</span><span class="w">         </span><span class="c1"># Spaces break Spark SQL</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers.silver</span><span class="w">   </span><span class="c1"># Dots break Spark SQL</span>
</code></pre></div></p>
<p>✅ <strong>Correct:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customers</span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact_sales</span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customers_silver</span>
</code></pre></div></p>
<p><strong>Error Message:</strong> <em>"Invalid node name 'X' for Spark engine. Names must contain only alphanumeric characters and underscores"</em></p>
<h3 id="182-scd2-is-self-contained-no-write-block-needed">18.2 SCD2 Is Self-Contained (No Write Block Needed)<a class="headerlink" href="#182-scd2-is-self-contained-no-write-block-needed" title="Permanent link">&para;</a></h3>
<p>SCD2 writes directly to the target table on all engines. Do <strong>not</strong> add a <code>write:</code> block for SCD2 nodes — the transformer handles persistence internally.</p>
<p>✅ <strong>Correct:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nt">transformer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scd2</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nt">params</span><span class="p">:</span>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">  </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customers</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">  </span><span class="nt">keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="w">  </span><span class="nt">track_cols</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">name</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">email</span><span class="p p-Indicator">]</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">  </span><span class="c1"># No write: block needed</span>
</code></pre></div></p>
<h3 id="183-missing-depends_on-for-joins">18.3 Missing depends_on for Joins<a class="headerlink" href="#183-missing-depends_on-for-joins" title="Permanent link">&para;</a></h3>
<p>❌ <strong>Wrong:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact_sales</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="w">  </span><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">join</span><span class="p">:</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">        </span><span class="nt">right_dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customer</span><span class="w">  </span><span class="c1"># Not in depends_on!</span>
</code></pre></div></p>
<p>✅ <strong>Correct:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact_sales</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">  </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">dim_customer</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Required!</span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">  </span><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">join</span><span class="p">:</span>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="w">        </span><span class="nt">right_dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dim_customer</span>
</code></pre></div></p>
<p><strong>Error Message:</strong> <em>"Join failed: dataset 'dim_customer' not found in context"</em></p>
<h3 id="184-engine-specific-sql-syntax">18.4 Engine-Specific SQL Syntax<a class="headerlink" href="#184-engine-specific-sql-syntax" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Pandas (DuckDB)</th>
<th>Spark</th>
</tr>
</thead>
<tbody>
<tr>
<td>Exclude columns</td>
<td><code>SELECT * EXCLUDE (col)</code></td>
<td><code>SELECT * EXCEPT (col)</code></td>
</tr>
<tr>
<td>String contains</td>
<td><code>ILIKE '%pattern%'</code></td>
<td><code>LIKE '%pattern%'</code></td>
</tr>
<tr>
<td>Array explode</td>
<td><code>UNNEST(arr)</code></td>
<td><code>explode(arr)</code></td>
</tr>
<tr>
<td>Null-safe compare</td>
<td><code>IS DISTINCT FROM</code></td>
<td><code>IS DISTINCT FROM</code> (both support)</td>
</tr>
</tbody>
</table>
<p><strong>Transformers handle this automatically</strong> - prefer using transformers over raw SQL.</p>
<h3 id="185-performance-gotchas">18.5 Performance Gotchas<a class="headerlink" href="#185-performance-gotchas" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pandas OOM on large data</td>
<td>Use Spark engine or chunked processing</td>
</tr>
<tr>
<td>Slow Spark startup</td>
<td>Reuse SparkSession, use <code>--parallel</code></td>
</tr>
<tr>
<td>Repeated Delta reads</td>
<td>Cache with <code>df.cache()</code> or persist</td>
</tr>
<tr>
<td>Large quarantine tables</td>
<td>Use <code>max_rows</code> and <code>sample_fraction</code></td>
</tr>
</tbody>
</table>
<h3 id="186-common-error-messages">18.6 Common Error Messages<a class="headerlink" href="#186-common-error-messages" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Error</th>
<th>Cause</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>"DataFrame 'X' not found in context"</em></td>
<td>Missing <code>depends_on</code></td>
<td>Add to <code>depends_on</code> list</td>
</tr>
<tr>
<td><em>"Column 'X' not found"</em></td>
<td>Typo or missing column</td>
<td>Check schema, run <code>--dry-run</code></td>
</tr>
<tr>
<td><em>"SCD2: provide either 'target' OR both 'connection' and 'path'"</em></td>
<td>Invalid SCD2 config</td>
<td>Use one approach, not both</td>
</tr>
<tr>
<td><em>"Key Vault fetch timed out"</em></td>
<td>Network/auth issue</td>
<td>Check VPN, credentials</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="19-sql-server-writer">19. SQL Server Writer<a class="headerlink" href="#19-sql-server-writer" title="Permanent link">&para;</a></h2>
<h3 id="191-merge-operations">19.1 Merge Operations<a class="headerlink" href="#191-merge-operations" title="Permanent link">&para;</a></h3>
<p>Write to SQL Server with MERGE (upsert) semantics:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure_sql</span>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql_server</span>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">  </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sales.fact_orders</span>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merge</span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="w">  </span><span class="nt">merge_keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">DateId</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">store_id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w">  </span><span class="nt">merge_options</span><span class="p">:</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="w">    </span><span class="nt">update_condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;source._hash_diff</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">target._hash_diff&quot;</span>
<a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="w">    </span><span class="nt">delete_condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;source._is_deleted</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">1&quot;</span>
<a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="w">    </span><span class="nt">insert_condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;source.is_valid</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">1&quot;</span>
<a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="w">    </span><span class="nt">exclude_columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">_hash_diff</span><span class="p p-Indicator">]</span>
<a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a><span class="w">    </span><span class="nt">staging_schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a><span class="w">    </span><span class="nt">audit_cols</span><span class="p">:</span>
<a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a><span class="w">      </span><span class="nt">created_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">created_ts</span>
<a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a><span class="w">      </span><span class="nt">updated_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_ts</span>
<a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a><span class="w">    </span><span class="nt">auto_create_table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-96-17" name="__codelineno-96-17" href="#__codelineno-96-17"></a><span class="w">    </span><span class="nt">primary_key_on_merge_keys</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p><strong>Merge Options:</strong>
| Option | Description |
|--------|-------------|
| <code>update_condition</code> | Only update rows matching this SQL condition |
| <code>delete_condition</code> | Delete rows matching this condition (soft delete) |
| <code>insert_condition</code> | Only insert rows matching this condition |
| <code>exclude_columns</code> | Columns to exclude from target table |
| <code>staging_schema</code> | Schema for staging table (default: <code>staging</code>) |
| <code>auto_create_table</code> | Auto-create target if not exists |
| <code>auto_create_schema</code> | Auto-create schema if not exists |
| <code>batch_size</code> | Chunk large DataFrames for memory efficiency |</p>
<h3 id="192-overwrite-strategies">19.2 Overwrite Strategies<a class="headerlink" href="#192-overwrite-strategies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure_sql</span>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sql_server</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">  </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fact.combined_downtime</span>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overwrite</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">  </span><span class="nt">overwrite_options</span><span class="p">:</span>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">truncate_insert</span><span class="w">  </span><span class="c1"># or: drop_create, delete_insert</span>
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w">    </span><span class="nt">audit_cols</span><span class="p">:</span>
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w">      </span><span class="nt">created_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">created_ts</span>
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">      </span><span class="nt">updated_col</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_ts</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Behavior</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>truncate_insert</code></td>
<td>TRUNCATE then INSERT</td>
<td>Fastest, requires TRUNCATE permission</td>
</tr>
<tr>
<td><code>drop_create</code></td>
<td>DROP, CREATE, INSERT</td>
<td>Refreshes schema</td>
</tr>
<tr>
<td><code>delete_insert</code></td>
<td>DELETE then INSERT</td>
<td>Works with limited permissions</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="20-incremental-loading-advanced">20. Incremental Loading (Advanced)<a class="headerlink" href="#20-incremental-loading-advanced" title="Permanent link">&para;</a></h2>
<h3 id="201-stateful-high-water-mark">20.1 Stateful High Water Mark<a class="headerlink" href="#201-stateful-high-water-mark" title="Permanent link">&para;</a></h3>
<p>Track the last processed value for exact incremental loading:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="nt">read</span><span class="p">:</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source_db</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">  </span><span class="nt">table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="nt">incremental</span><span class="p">:</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stateful</span><span class="w">           </span><span class="c1"># Track HWM in system catalog</span>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="w">  </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="w">  </span><span class="nt">state_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders_hwm</span><span class="w">    </span><span class="c1"># Unique ID for state tracking</span>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w">  </span><span class="nt">watermark_lag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2h&quot;</span><span class="w">      </span><span class="c1"># Safety buffer for late-arriving data</span>
</code></pre></div>
<p><strong>Watermark Lag:</strong> Subtracts this duration from stored HWM when filtering. Use when source has replication lag or eventual consistency.</p>
<h3 id="202-rolling-window">20.2 Rolling Window<a class="headerlink" href="#202-rolling-window" title="Permanent link">&para;</a></h3>
<p>Load recent data without state tracking:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="nt">incremental</span><span class="p">:</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rolling_window</span>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="w">  </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="w">  </span><span class="nt">lookback</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="w">  </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span><span class="w">  </span><span class="c1"># hour, day, month, year</span>
</code></pre></div>
<h3 id="203-date-format-handling">20.3 Date Format Handling<a class="headerlink" href="#203-date-format-handling" title="Permanent link">&para;</a></h3>
<p>For string columns with specific date formats:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="nt">incremental</span><span class="p">:</span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rolling_window</span>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">  </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EVENT_START</span>
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w">  </span><span class="nt">lookback</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">  </span><span class="nt">unit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">  </span><span class="nt">date_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oracle</span><span class="w">  </span><span class="c1"># DD-MON-YY format</span>
</code></pre></div>
<p><strong>Supported formats:</strong>
| Format | Pattern | Use Case |
|--------|---------|----------|
| <code>oracle</code> | DD-MON-YY | Oracle databases |
| <code>oracle_sqlserver</code> | DD-MON-YY in SQL Server | Legacy migrations |
| <code>sql_server</code> | CONVERT style 120 | SQL Server |
| <code>us</code> | MM/DD/YYYY | US format |
| <code>eu</code> | DD/MM/YYYY | European format |
| <code>iso</code> | YYYY-MM-DDTHH:MM:SS | ISO 8601 |</p>
<hr />
<h2 id="21-diagnostics-diff-tools">21. Diagnostics &amp; Diff Tools<a class="headerlink" href="#21-diagnostics-diff-tools" title="Permanent link">&para;</a></h2>
<h3 id="211-delta-table-diff">21.1 Delta Table Diff<a class="headerlink" href="#211-delta-table-diff" title="Permanent link">&para;</a></h3>
<p>Compare two versions of a Delta table:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.diagnostics.delta</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_delta_diff</span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">get_delta_diff</span><span class="p">(</span>
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a>    <span class="n">table_path</span><span class="o">=</span><span class="s2">&quot;abfss://lake/silver/customers&quot;</span><span class="p">,</span>
<a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a>    <span class="n">version_a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a>    <span class="n">version_b</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a>    <span class="n">spark</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span>
<a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a>    <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>           <span class="c1"># Row-by-row comparison</span>
<a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a>    <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;customer_id&quot;</span><span class="p">]</span> <span class="c1"># For detecting updates</span>
<a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="p">)</span>
<a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a>
<a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rows changed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">rows_change</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Schema added: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">schema_added</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Schema removed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">schema_removed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Operations: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">operations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="212-run-diff">21.2 Run Diff<a class="headerlink" href="#212-run-diff" title="Permanent link">&para;</a></h3>
<p>Compare two pipeline runs to identify drift:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.diagnostics.diff</span><span class="w"> </span><span class="kn">import</span> <span class="n">diff_nodes</span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">diff_nodes</span><span class="p">(</span><span class="n">node_a_metadata</span><span class="p">,</span> <span class="n">node_b_metadata</span><span class="p">)</span>
<a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a>
<a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">has_drift</span><span class="p">:</span>
<a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status change: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">status_change</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rows diff: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">rows_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns added: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">columns_added</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns removed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">columns_removed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="22-cross-check-transformer">22. Cross-Check Transformer<a class="headerlink" href="#22-cross-check-transformer" title="Permanent link">&para;</a></h2>
<p>Validate data across multiple nodes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="nt">transform</span><span class="p">:</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cross_check</span><span class="p">:</span>
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">row_count_diff</span>
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">node_a</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">node_b</span><span class="p p-Indicator">]</span>
<a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">      </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w">  </span><span class="c1"># Allow 5% difference</span>
<a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a>
<a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cross_check</span><span class="p">:</span>
<a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">schema_match</span>
<a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="w">      </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">staging_orders</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">prod_orders</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p><strong>Check Types:</strong>
| Type | Behavior |
|------|----------|
| <code>row_count_diff</code> | Compare row counts, fail if diff exceeds threshold |
| <code>schema_match</code> | Ensure schemas are identical |</p>
<hr />
<h2 id="23-testing-utilities">23. Testing Utilities<a class="headerlink" href="#23-testing-utilities" title="Permanent link">&para;</a></h2>
<h3 id="231-test-fixtures">23.1 Test Fixtures<a class="headerlink" href="#231-test-fixtures" title="Permanent link">&para;</a></h3>
<p>Generate sample data for tests:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.testing.fixtures</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_sample_data</span><span class="p">,</span> <span class="n">temp_directory</span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="c1"># Generate sample DataFrame</span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="n">df</span> <span class="o">=</span> <span class="n">generate_sample_data</span><span class="p">(</span>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>    <span class="n">rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a>    <span class="n">engine_type</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;spark&quot;</span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a>    <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">}</span>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="p">)</span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a>
<a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="c1"># Temporary directory for test artifacts</span>
<a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="k">with</span> <span class="n">temp_directory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
<a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">/test.parquet&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="232-assertions">23.2 Assertions<a class="headerlink" href="#232-assertions" title="Permanent link">&para;</a></h3>
<p>Assert DataFrame equality:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.testing.assertions</span><span class="w"> </span><span class="kn">import</span> <span class="n">assert_frame_equal</span><span class="p">,</span> <span class="n">assert_schema_equal</span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>
<a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="c1"># Compare DataFrames (works with Pandas and Spark)</span>
<a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">actual_df</span><span class="p">,</span> <span class="n">expected_df</span><span class="p">,</span> <span class="n">check_dtype</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a>
<a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a><span class="c1"># Compare schemas only</span>
<a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a><span class="n">assert_schema_equal</span><span class="p">(</span><span class="n">actual_df</span><span class="p">,</span> <span class="n">expected_df</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="24-derived-updater-internal">24. Derived Updater (Internal)<a class="headerlink" href="#24-derived-updater-internal" title="Permanent link">&para;</a></h2>
<p>The DerivedUpdater provides exactly-once semantics for system catalog updates:</p>
<ul>
<li><strong>Guard table:</strong> <code>meta_derived_applied_runs</code> prevents duplicate processing</li>
<li><strong>Retry with backoff:</strong> Handles Delta concurrency conflicts</li>
<li><strong>Stale claim recovery:</strong> Reclaims stuck jobs after timeout</li>
</ul>
<p><strong>Valid derived tables:</strong>
- <code>meta_daily_stats</code> - Daily execution statistics
- <code>meta_pipeline_health</code> - Pipeline health scores
- <code>meta_sla_status</code> - SLA compliance tracking</p>
<hr />
<h2 id="25-extension-points">25. Extension Points<a class="headerlink" href="#25-extension-points" title="Permanent link">&para;</a></h2>
<h3 id="251-custom-patterns">25.1 Custom Patterns<a class="headerlink" href="#251-custom-patterns" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.patterns.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pattern</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">EngineContext</span>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyPattern</span><span class="p">(</span><span class="n">Pattern</span><span class="p">):</span>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required_param&quot;</span><span class="p">):</span>
<a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MyPattern: &#39;required_param&#39; is required&quot;</span><span class="p">)</span>
<a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a>
<a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">EngineContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a>        <span class="c1"># Transform and return DataFrame</span>
<a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a>        <span class="k">return</span> <span class="n">transformed_df</span>
</code></pre></div>
<h3 id="252-custom-connections">25.2 Custom Connections<a class="headerlink" href="#252-custom-connections" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.connections.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseConnection</span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyConnection</span><span class="p">(</span><span class="n">BaseConnection</span><span class="p">):</span>
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a>
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">relative_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a>
<a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">:</span>
<a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;API key required&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="253-plugin-system">25.3 Plugin System<a class="headerlink" href="#253-plugin-system" title="Permanent link">&para;</a></h3>
<p>Register via entry points in <code>pyproject.toml</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="k">[project.entry-points.</span><span class="s2">&quot;odibi.connections&quot;</span><span class="k">]</span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="n">my_connector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_package.connections:MyConnectionFactory&quot;</span>
</code></pre></div></p>
<p>Plugins discovered via:
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">odibi.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_plugins</span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="n">load_plugins</span><span class="p">()</span>  <span class="c1"># Called automatically on startup</span>
</code></pre></div></p>
<hr />
<h2 id="26-quick-reference-cheat-sheet">26. Quick Reference Cheat Sheet<a class="headerlink" href="#26-quick-reference-cheat-sheet" title="Permanent link">&para;</a></h2>
<h3 id="yaml-node-structure">YAML Node Structure<a class="headerlink" href="#yaml-node-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="nt">nodes</span><span class="p">:</span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node_name</span><span class="w">              </span><span class="c1"># Required, alphanumeric + underscore</span>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">other_node</span><span class="p p-Indicator">]</span><span class="w">     </span><span class="c1"># Dependencies for execution order</span>
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">silver</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">daily</span><span class="p p-Indicator">]</span><span class="w">        </span><span class="c1"># For filtering with --tag</span>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w">      </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">other_node</span><span class="w">         </span><span class="c1"># Input from another node</span>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">    </span><span class="nt">read</span><span class="p">:</span><span class="w">                        </span><span class="c1"># OR read from connection</span>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w">      </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conn_name</span>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">relative/path</span>
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="w">      </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parquet</span><span class="w">            </span><span class="c1"># parquet, delta, csv, json</span>
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">    </span><span class="nt">transform</span><span class="p">:</span><span class="w">                   </span><span class="c1"># List of transformations</span>
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">filter_rows</span><span class="p">:</span>
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">          </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;col</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0&quot;</span>
<a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">derive_columns</span><span class="p">:</span>
<a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">          </span><span class="nt">derivations</span><span class="p">:</span>
<a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w">            </span><span class="nt">new_col</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;expr&quot;</span>
<a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w">                     </span><span class="c1"># OR use a pattern</span>
<a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dimension</span>
<a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a><span class="w">      </span><span class="nt">params</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">...</span><span class="p p-Indicator">}</span>
<a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a><span class="w">    </span><span class="nt">validate</span><span class="p">:</span>
<a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a><span class="w">      </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-110-22" name="__codelineno-110-22" href="#__codelineno-110-22"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-110-23" name="__codelineno-110-23" href="#__codelineno-110-23"></a><span class="w">          </span><span class="nt">columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-110-24" name="__codelineno-110-24" href="#__codelineno-110-24"></a><span class="w">    </span><span class="nt">write</span><span class="p">:</span><span class="w">                       </span><span class="c1"># Persist output</span>
<a id="__codelineno-110-25" name="__codelineno-110-25" href="#__codelineno-110-25"></a><span class="w">      </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">conn_name</span>
<a id="__codelineno-110-26" name="__codelineno-110-26" href="#__codelineno-110-26"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output/path</span>
<a id="__codelineno-110-27" name="__codelineno-110-27" href="#__codelineno-110-27"></a><span class="w">      </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delta</span>
<a id="__codelineno-110-28" name="__codelineno-110-28" href="#__codelineno-110-28"></a><span class="w">      </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overwrite</span><span class="w">            </span><span class="c1"># overwrite, append, merge</span>
<a id="__codelineno-110-29" name="__codelineno-110-29" href="#__codelineno-110-29"></a><span class="w">      </span><span class="nt">partition_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">year</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">month</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># Physical partitioning</span>
<a id="__codelineno-110-30" name="__codelineno-110-30" href="#__codelineno-110-30"></a><span class="w">      </span><span class="nt">zorder_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">]</span><span class="w">   </span><span class="c1"># Z-ordering (Delta only)</span>
<a id="__codelineno-110-31" name="__codelineno-110-31" href="#__codelineno-110-31"></a><span class="w">      </span><span class="nt">merge_schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">         </span><span class="c1"># Allow schema evolution</span>
<a id="__codelineno-110-32" name="__codelineno-110-32" href="#__codelineno-110-32"></a><span class="w">      </span><span class="nt">auto_optimize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">        </span><span class="c1"># Run VACUUM/OPTIMIZE after write</span>
<a id="__codelineno-110-33" name="__codelineno-110-33" href="#__codelineno-110-33"></a><span class="w">      </span><span class="nt">add_metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">         </span><span class="c1"># Add _extracted_at, _source_file</span>
</code></pre></div>
<h3 id="common-transform-operations">Common Transform Operations<a class="headerlink" href="#common-transform-operations" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Task</th>
<th>Transformer</th>
</tr>
</thead>
<tbody>
<tr>
<td>Filter rows</td>
<td><code>filter_rows: {condition: "..."}</code></td>
</tr>
<tr>
<td>Add column</td>
<td><code>derive_columns: {derivations: {col: expr}}</code></td>
</tr>
<tr>
<td>Remove duplicates</td>
<td><code>deduplicate: {keys: [...], order_by: "..."}</code></td>
</tr>
<tr>
<td>Join tables</td>
<td><code>join: {right_dataset: x, on: [...], how: left}</code></td>
</tr>
<tr>
<td>Aggregate</td>
<td><code>aggregate: {group_by: [...], aggregations: {...}}</code></td>
</tr>
<tr>
<td>Type casting</td>
<td><code>cast_columns: {casts: {col: type}}</code></td>
</tr>
<tr>
<td>Rename columns</td>
<td><code>rename_columns: {mapping: {old: new}}</code></td>
</tr>
<tr>
<td>SCD2 history</td>
<td><code>scd2: {target: ..., keys: [...], track_cols: [...]}</code></td>
</tr>
<tr>
<td>Detect deletes</td>
<td><code>detect_deletes: {mode: sql_compare, keys: [...]}</code></td>
</tr>
</tbody>
</table>
<h3 id="query-node-results-spark">Query Node Results (Spark)<a class="headerlink" href="#query-node-results-spark" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="c1"># After pipeline.run()</span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM node_name&quot;</span><span class="p">)</span>
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM node_name WHERE condition&quot;</span><span class="p">)</span>
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="c1"># Get DataFrame directly</span>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="n">df</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node_name&quot;</span><span class="p">)</span>
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a>
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="c1"># List all available nodes</span>
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="n">context</span><span class="o">.</span><span class="n">list_names</span><span class="p">()</span>
</code></pre></div>
<h3 id="debug-commands">Debug Commands<a class="headerlink" href="#debug-commands" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>odibi<span class="w"> </span>run<span class="w"> </span>x.yaml<span class="w"> </span>--dry-run<span class="w">      </span><span class="c1"># Validate only</span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>odibi<span class="w"> </span>run<span class="w"> </span>x.yaml<span class="w"> </span>--log-level<span class="w"> </span>DEBUG
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>odibi<span class="w"> </span>story<span class="w"> </span>last<span class="w">                </span><span class="c1"># View execution story</span>
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a>odibi<span class="w"> </span>graph<span class="w"> </span>x.yaml<span class="w">              </span><span class="c1"># View dependencies</span>
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a>odibi<span class="w"> </span>doctor<span class="w">                    </span><span class="c1"># Check environment</span>
</code></pre></div>
<h3 id="validation-quick-reference">Validation Quick Reference<a class="headerlink" href="#validation-quick-reference" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="nt">validate</span><span class="p">:</span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="w">  </span><span class="nt">tests</span><span class="p">:</span>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="w">      </span><span class="nt">columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">      </span><span class="nt">on_fail</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fail</span><span class="w">          </span><span class="c1"># fail, warn, quarantine</span>
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unique</span>
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">      </span><span class="nt">columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">id</span><span class="p p-Indicator">]</span>
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">accepted_values</span>
<a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">status</span>
<a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="w">      </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">A</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">B</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">C</span><span class="p p-Indicator">]</span>
<a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">range</span>
<a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">amount</span>
<a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a><span class="w">      </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a><span class="w">      </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span>
<a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">freshness</span>
<a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a><span class="w">      </span><span class="nt">column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated_at</span>
<a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">      </span><span class="nt">max_age</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;24h&quot;</span>
</code></pre></div>
<h3 id="delta-lake-quick-reference">Delta Lake Quick Reference<a class="headerlink" href="#delta-lake-quick-reference" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="nt">write</span><span class="p">:</span>
<a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="w">  </span><span class="c1"># Performance optimization</span>
<a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="w">  </span><span class="nt">partition_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">country</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">year_month</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Low cardinality columns</span>
<a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="w">  </span><span class="nt">zorder_by</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">customer_id</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">product_id</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># High cardinality columns</span>
<a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a>
<a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="w">  </span><span class="c1"># Schema evolution</span>
<a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="w">  </span><span class="nt">merge_schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a>
<a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">  </span><span class="c1"># Auto maintenance (VACUUM/OPTIMIZE)</span>
<a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="w">  </span><span class="nt">auto_optimize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">  </span><span class="c1"># OR with custom retention:</span>
<a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="w">  </span><span class="nt">auto_optimize</span><span class="p">:</span>
<a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="w">    </span><span class="nt">vacuum_retention_hours</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">168</span><span class="w">  </span><span class="c1"># 7 days</span>
<a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a>
<a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="w">  </span><span class="c1"># Skip redundant writes</span>
<a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="w">  </span><span class="nt">skip_if_unchanged</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="w">  </span><span class="nt">skip_hash_columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">id</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">name</span><span class="p p-Indicator">]</span>
<a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a>
<a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a><span class="w">  </span><span class="c1"># Bronze metadata</span>
<a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="w">  </span><span class="nt">add_metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Adds _extracted_at, _source_file</span>
<a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a>
<a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="nt">read</span><span class="p">:</span>
<a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a><span class="w">  </span><span class="c1"># Time travel</span>
<a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="w">  </span><span class="nt">time_travel</span><span class="p">:</span>
<a id="__codelineno-114-26" name="__codelineno-114-26" href="#__codelineno-114-26"></a><span class="w">    </span><span class="nt">as_of_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-114-27" name="__codelineno-114-27" href="#__codelineno-114-27"></a><span class="w">    </span><span class="c1"># OR: as_of_timestamp: &quot;2023-10-01T12:00:00Z&quot;</span>
</code></pre></div>
<h3 id="alerts-quick-reference">Alerts Quick Reference<a class="headerlink" href="#alerts-quick-reference" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="nt">alerts</span><span class="p">:</span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slack</span><span class="w">              </span><span class="c1"># slack, teams, webhook</span>
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SLACK_WEBHOOK}&quot;</span>
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="w">    </span><span class="nt">on_events</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">on_failure</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">on_quarantine</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">on_gate_block</span><span class="p p-Indicator">]</span>
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="w">      </span><span class="nt">throttle_minutes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="w">      </span><span class="nt">channel</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;#data-alerts&quot;</span>
</code></pre></div>
<h3 id="connection-quick-reference">Connection Quick Reference<a class="headerlink" href="#connection-quick-reference" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="w">  </span><span class="nt">local</span><span class="p">:</span>
<a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="w">    </span><span class="nt">base_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a>
<a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="w">  </span><span class="nt">adls</span><span class="p">:</span>
<a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure_adls</span>
<a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="w">    </span><span class="nt">account</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myaccount</span>
<a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="w">    </span><span class="nt">container</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datalake</span>
<a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="w">    </span><span class="nt">auth_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">managed_identity</span>
<a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a>
<a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a><span class="w">  </span><span class="nt">sql</span><span class="p">:</span>
<a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure_sql</span>
<a id="__codelineno-116-14" name="__codelineno-116-14" href="#__codelineno-116-14"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server.database.windows.net</span>
<a id="__codelineno-116-15" name="__codelineno-116-15" href="#__codelineno-116-15"></a><span class="w">    </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-116-16" name="__codelineno-116-16" href="#__codelineno-116-16"></a><span class="w">    </span><span class="nt">auth_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aad_msi</span>
</code></pre></div>
<hr />
<h2 id="27-documentation-map">27. Documentation Map<a class="headerlink" href="#27-documentation-map" title="Permanent link">&para;</a></h2>
<p>This section lists all detailed documentation files. Use <code>get_doc("path")</code> to retrieve any doc.</p>
<h3 id="core-reference">Core Reference<a class="headerlink" href="#core-reference" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/reference/yaml_schema.md</code> - Complete YAML configuration reference</li>
<li><code>docs/reference/cheatsheet.md</code> - Quick reference card</li>
<li><code>docs/reference/configuration.md</code> - Configuration options</li>
<li><code>docs/reference/glossary.md</code> - Term definitions</li>
<li><code>docs/troubleshooting.md</code> - Common issues and solutions</li>
<li><code>docs/golden_path.md</code> - Recommended workflow</li>
</ul>
<h3 id="patterns-16-docs">Patterns (16 docs)<a class="headerlink" href="#patterns-16-docs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/patterns/dimension.md</code> - Dimension pattern details</li>
<li><code>docs/patterns/fact.md</code> - Fact table pattern</li>
<li><code>docs/patterns/scd2.md</code> - SCD Type 2 implementation</li>
<li><code>docs/patterns/aggregation.md</code> - Aggregation pattern</li>
<li><code>docs/patterns/date_dimension.md</code> - Date dimension generation</li>
<li><code>docs/patterns/merge_upsert.md</code> - Merge/upsert pattern</li>
<li><code>docs/patterns/incremental_stateful.md</code> - Stateful incremental loads</li>
<li><code>docs/patterns/smart_read.md</code> - Smart read with HWM</li>
<li><code>docs/patterns/sql_server_merge.md</code> - SQL Server MERGE statement</li>
<li><code>docs/patterns/anti_patterns.md</code> - What NOT to do</li>
</ul>
<h3 id="guides-21-docs">Guides (21 docs)<a class="headerlink" href="#guides-21-docs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/guides/best_practices.md</code> - Best practices</li>
<li><code>docs/guides/writing_transformations.md</code> - How to write transforms</li>
<li><code>docs/guides/dimensional_modeling_guide.md</code> - Star schema design</li>
<li><code>docs/guides/python_api_guide.md</code> - Python API usage</li>
<li><code>docs/guides/cli_master_guide.md</code> - CLI deep dive</li>
<li><code>docs/guides/testing.md</code> - Testing strategies</li>
<li><code>docs/guides/performance_tuning.md</code> - Performance optimization</li>
<li><code>docs/guides/production_deployment.md</code> - Production setup</li>
<li><code>docs/guides/secrets.md</code> - Secret management</li>
<li><code>docs/guides/environments.md</code> - Environment configuration</li>
</ul>
<h3 id="features-22-docs">Features (22 docs)<a class="headerlink" href="#features-22-docs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/features/transformers.md</code> - Transformer system</li>
<li><code>docs/features/validation.md</code> - Data validation</li>
<li><code>docs/features/quarantine.md</code> - Quarantine system</li>
<li><code>docs/features/quality_gates.md</code> - Quality gates</li>
<li><code>docs/features/connections.md</code> - Connection types</li>
<li><code>docs/features/engines.md</code> - Pandas/Spark/Polars engines</li>
<li><code>docs/features/patterns.md</code> - Pattern overview</li>
<li><code>docs/features/lineage.md</code> - Data lineage</li>
<li><code>docs/features/stories.md</code> - Execution stories</li>
<li><code>docs/features/catalog.md</code> - System catalog</li>
</ul>
<h3 id="tutorials-19-docs">Tutorials (19 docs)<a class="headerlink" href="#tutorials-19-docs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/tutorials/getting_started.md</code> - Getting started</li>
<li><code>docs/tutorials/bronze_layer.md</code> - Bronze layer tutorial</li>
<li><code>docs/tutorials/silver_layer.md</code> - Silver layer tutorial</li>
<li><code>docs/tutorials/gold_layer.md</code> - Gold layer tutorial</li>
<li><code>docs/tutorials/spark_engine.md</code> - Using Spark</li>
<li><code>docs/tutorials/dimensional_modeling/</code> - Dimensional modeling series (12 parts)</li>
</ul>
<h3 id="context-phases-14-docs">Context Phases (14 docs)<a class="headerlink" href="#context-phases-14-docs" title="Permanent link">&para;</a></h3>
<p>Deep-dive implementation context for each system component:
- <code>docs/context/PHASE_1_CORE_EXECUTION.md</code> - Core execution
- <code>docs/context/PHASE_2_PATTERNS.md</code> - Pattern system
- <code>docs/context/PHASE_3_TRANSFORMERS.md</code> - Transformer implementation
- <code>docs/context/PHASE_4_CONNECTIONS.md</code> - Connection system
- <code>docs/context/PHASE_5_RUNTIME.md</code> - Runtime behavior
- <code>docs/context/PHASE_6_WORKFLOWS.md</code> - Common workflows
- <code>docs/context/PHASE_7_GOTCHAS.md</code> - Gotchas and edge cases
- <code>docs/context/PHASE_8_CLI.md</code> - CLI implementation
- <code>docs/context/PHASE_9_EXTENSIONS.md</code> - Extension points</p>
<h3 id="examples-10-docs">Examples (10 docs)<a class="headerlink" href="#examples-10-docs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/examples/canonical/01_hello_world.md</code> - Hello world</li>
<li><code>docs/examples/canonical/02_incremental_sql.md</code> - Incremental loading</li>
<li><code>docs/examples/canonical/03_scd2_dimension.md</code> - SCD2 example</li>
<li><code>docs/examples/canonical/04_fact_table.md</code> - Fact table example</li>
<li><code>docs/examples/canonical/05_full_pipeline.md</code> - Full pipeline</li>
<li><code>docs/examples/canonical/THE_REFERENCE.md</code> - Reference implementation</li>
</ul>
<h3 id="validation-4-docs">Validation (4 docs)<a class="headerlink" href="#validation-4-docs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/validation/README.md</code> - Validation overview</li>
<li><code>docs/validation/tests.md</code> - Validation tests</li>
<li><code>docs/validation/contracts.md</code> - Data contracts</li>
<li><code>docs/validation/fk.md</code> - Foreign key validation</li>
</ul>
<h3 id="semantic-layer-6-docs">Semantic Layer (6 docs)<a class="headerlink" href="#semantic-layer-6-docs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docs/semantics/index.md</code> - Semantic layer overview</li>
<li><code>docs/semantics/metrics.md</code> - Metric definitions</li>
<li><code>docs/semantics/query.md</code> - Querying metrics</li>
<li><code>docs/semantics/materialize.md</code> - Materialization</li>
<li><code>docs/semantics/runner.md</code> - Semantic runner</li>
</ul>
<blockquote>
<p><strong>MCP Usage:</strong> Call <code>list_docs(category="patterns")</code> to list all pattern docs, then <code>get_doc("docs/patterns/scd2.md")</code> to get specific content.</p>
</blockquote>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.expand", "toc.integrate", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>