project: delta_lake_production
description: Production Delta Lake pipeline with Bronze/Silver/Gold architecture
engine: pandas
connections:
  local:
    type: local
    base_path: ./pipeline_data
  bronze:
    type: azure_adls
    account: your_account_name
    container: your_container_name
    path_prefix: raw
    auth_mode: key_vault
    key_vault_name: your_key_valut
    secret_name: your_secret_name
  silver:
    type: azure_adls
    account: your_account_name
    container: your_container_name
    path_prefix: clean
    auth_mode: key_vault
    key_vault_name: your_key_valut
    secret_name: your_secret_name
  gold:
    type: azure_adls
    account: your_account_name
    container: your_container_name
    path_prefix: aggregated
    auth_mode: key_vault
    key_vault_name: your_key_valut
    secret_name: your_secret_name
story:
  connection: local
  path: stories/
  enabled: true
retry:
  max_attempts: 3
  backoff_seconds: 2.0
logging:
  level: INFO
pipelines:
- pipeline: bronze_to_silver
  name: Bronze to Silver - Sales Data
  description: Convert raw CSV to cleaned Delta Lake tables
  nodes:
  - name: read_raw_sales
    read:
      connection: bronze
      path: sales/raw_sales.csv
      format: csv
  - name: clean_sales
    depends_on:
    - read_raw_sales
    transform:
      steps:
      - "\n                            SELECT \n                                *,\n\
        \                                now() as processed_at\n                 \
        \           FROM read_raw_sales \n                            WHERE order_id\
        \ IS NOT NULL \n                            AND amount > 0\n             \
        \               "
  - name: write_silver_sales
    depends_on:
    - clean_sales
    write:
      connection: silver
      path: sales/sales.delta
      format: delta
      mode: append
- pipeline: silver_to_gold
  name: Silver to Gold - Daily Aggregates
  description: Create business-ready aggregated tables
  nodes:
  - name: read_silver_sales
    read:
      connection: silver
      path: sales/sales.delta
      format: delta
  - name: aggregate_daily
    depends_on:
    - read_silver_sales
    transform:
      steps:
      - "\n                            SELECT \n                                DATE(processed_at)\
        \ as date,\n                                COUNT(*) as order_count,\n   \
        \                             SUM(amount) as total_amount,\n             \
        \                   AVG(amount) as avg_amount,\n                         \
        \       MIN(amount) as min_amount,\n                                MAX(amount)\
        \ as max_amount\n                            FROM read_silver_sales\n    \
        \                        GROUP BY DATE(processed_at)\n                   \
        \         ORDER BY date DESC\n                            "
  - name: write_gold_daily
    depends_on:
    - aggregate_daily
    write:
      connection: gold
      path: sales/daily_summary.delta
      format: delta
      mode: overwrite
- pipeline: audit_delta_versions
  name: Audit Trail - Compare Versions
  description: Compare current vs previous Delta versions
  nodes:
  - name: read_current
    read:
      connection: silver
      path: sales/sales.delta
      format: delta
  - name: read_previous
    read:
      connection: silver
      path: sales/sales.delta
      format: delta
      options:
        versionAsOf: 0
  - name: compare_versions
    depends_on:
    - read_current
    - read_previous
    transform:
      steps:
      - "\n                            SELECT \n                                'Current'\
        \ as version_type,\n                                COUNT(*) as row_count,\n\
        \                                SUM(amount) as total_amount\n           \
        \                 FROM read_current\n                            UNION ALL\n\
        \                            SELECT \n                                'Previous'\
        \ as version_type,\n                                COUNT(*) as row_count,\n\
        \                                SUM(amount) as total_amount\n           \
        \                 FROM read_previous\n                            "
  - name: save_audit
    depends_on:
    - compare_versions
    write:
      connection: local
      path: audit/version_comparison.csv
      format: csv
